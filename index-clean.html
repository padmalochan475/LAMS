<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Institute Lab Management System</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
    <!-- Floating orbs for background animation -->
    <div class="floating-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
    </div>

    <!-- Main container -->
    <div class="container">
        <header class="header">
            <h1 class="header-title">Institute Lab Management System</h1>
            <div class="header-actions">
                <div id="user-info" class="user-info" style="display: none;">
                    <img id="user-avatar" class="user-avatar" src="" alt="User">
                    <span id="user-name"></span>
                    <button class="btn btn--secondary" onclick="signOut()">Sign Out</button>
                </div>
                <div id="login-section">
                    <div id="g_id_onload"
                         data-client_id="485361990614-74vhnb9vqjulp17gno3janj8blugshpr.apps.googleusercontent.com"
                         data-callback="handleCredentialResponse"
                         data-auto_prompt="false">
                    </div>
                    <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"></div>
                </div>
                <button class="theme-toggle btn--secondary" id="themeToggle">
                    <span class="nav-icon">üåô</span>
                </button>
            </div>
        </header>

        <!-- Notification Bar -->
        <div id="notification" class="notification"></div>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" data-tab="dashboard">
                <span class="nav-icon">üìä</span>
                Dashboard
            </button>
            <button class="nav-btn" data-tab="calendar">
                <span class="nav-icon">üìÖ</span>
                Calendar
            </button>
            <button class="nav-btn" data-tab="faculty">
                <span class="nav-icon">üë•</span>
                Faculty
            </button>
            <button class="nav-btn" data-tab="analytics">
                <span class="nav-icon">üìà</span>
                Analytics
            </button>
            <button class="nav-btn print-btn" onclick="printSchedule()">
                <span class="nav-icon">üñ®Ô∏è</span>
                Print Schedule
            </button>
        </nav>

        <!-- Loading Screen -->
        <div id="loadingScreen" class="loading-screen">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Validating deployment...</p>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard-tab">
            <div class="dashboard-header">
                <h2>Academic Year: <span id="currentAcademicYear" class="academic-year-display" onclick="editAcademicYear()">2024-25</span></h2>
                <div class="dashboard-actions">
                    <div class="sync-status" id="syncStatus" style="display: inline-block;">
                        <span class="nav-icon">‚òÅÔ∏è</span> <span id="syncStatusText">Loading...</span>
                    </div>
                    <button class="btn btn--secondary" onclick="exportData()" title="Export Data">
                        <span class="nav-icon">üì•</span> Export
                    </button>
                    <button class="btn btn--secondary admin-btn" onclick="importData()" title="Import Data (Admin Only)">
                        <span class="nav-icon">üì§</span> Import
                    </button>
                    <button class="btn btn--secondary admin-btn" onclick="showUserManagement()" title="Manage Users (Admin Only)">
                        <span class="nav-icon">üë•</span> Users
                        <span id="pendingUsersCount" class="pending-badge" style="display: none;">0</span>
                    </button>
                </div>
            </div>
            <div class="dashboard-grid">
                <div class="stat-card glass-card">
                    <div class="stat-icon">üìö</div>
                    <div class="stat-info">
                        <div class="stat-number" id="totalAssignments">0</div>
                        <div class="stat-label">Total Assignments</div>
                    </div>
                </div>
                <div class="stat-card glass-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-info">
                        <div class="stat-number" id="completedAssignments">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>
                <div class="stat-card glass-card">
                    <div class="stat-icon">‚è≥</div>
                    <div class="stat-info">
                        <div class="stat-number" id="pendingAssignments">0</div>
                        <div class="stat-label">Pending</div>
                    </div>
                </div>
                <div class="stat-card glass-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-info">
                        <div class="stat-number" id="totalFaculty">0</div>
                        <div class="stat-label">Faculty Members</div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="quick-actions glass-card">
                <h3>Quick Actions</h3>
                <div class="action-buttons">
                    <button class="btn btn--primary" onclick="showAssignmentModal()">
                        <span class="nav-icon">‚ûï</span> Add Assignment
                    </button>
                    <button class="btn btn--secondary" onclick="switchToTab('faculty')">
                        <span class="nav-icon">üë§</span> Manage Faculty
                    </button>
                    <button class="btn btn--secondary" onclick="switchToTab('analytics')">
                        <span class="nav-icon">üìä</span> View Analytics
                    </button>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="activity-feed glass-card">
                <h3>Recent Activity</h3>
                <div id="recentActivity" class="activity-list">
                    <p class="empty-state">No recent activity</p>
                </div>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div class="tab-content" id="calendar-tab">
            <div class="calendar-header">
                <button class="btn btn--secondary" id="prevMonth">&lt;</button>
                <h2 id="currentMonth">January 2024</h2>
                <button class="btn btn--secondary" id="nextMonth">&gt;</button>
                <button class="btn btn--primary" onclick="showAssignmentModal()">Add Assignment</button>
            </div>
            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar will be generated by JavaScript -->
            </div>
        </div>

        <!-- Faculty Tab -->
        <div class="tab-content" id="faculty-tab">
            <div class="faculty-header">
                <h2>Faculty Management</h2>
                <button class="btn btn--primary" onclick="showFacultyModal()">Add Faculty</button>
            </div>
            <div class="faculty-grid" id="facultyGrid">
                <!-- Faculty cards will be generated by JavaScript -->
            </div>
        </div>

        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics-tab">
            <div class="analytics-header">
                <h2>Analytics & Reports</h2>
            </div>
            <div class="analytics-grid">
                <div class="chart-container glass-card">
                    <h3>Assignment Completion Rate</h3>
                    <canvas id="completionChart"></canvas>
                </div>
                <div class="chart-container glass-card">
                    <h3>Monthly Assignments</h3>
                    <canvas id="monthlyChart"></canvas>
                </div>
                <div class="chart-container glass-card">
                    <h3>Faculty Workload</h3>
                    <canvas id="workloadChart"></canvas>
                </div>
                <div class="stats-summary glass-card">
                    <h3>Summary Statistics</h3>
                    <div class="summary-stats" id="summaryStats">
                        <!-- Generated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Assignment Modal -->
        <div id="assignmentModal" class="modal">
            <div class="modal-content">
                <h3 id="assignmentModalTitle">Add Assignment</h3>
                <form id="assignmentForm">
                    <div class="form-group">
                        <label for="subject">Subject:</label>
                        <select id="subject" required>
                            <option value="">Select Subject</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="faculty">Faculty:</label>
                        <select id="faculty" required>
                            <option value="">Select Faculty</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="lab">Lab:</label>
                        <select id="lab" required>
                            <option value="">Select Lab</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="date">Date:</label>
                        <input type="date" id="date" required>
                    </div>
                    <div class="form-group">
                        <label for="time">Time:</label>
                        <select id="time" required>
                            <option value="">Select Time Slot</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="description">Description (Optional):</label>
                        <textarea id="description" rows="3"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn--secondary" onclick="closeAssignmentModal()">Cancel</button>
                        <button type="submit" class="btn btn--primary">Save Assignment</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Faculty Modal -->
        <div id="facultyModal" class="modal">
            <div class="modal-content">
                <h3 id="facultyModalTitle">Add Faculty</h3>
                <form id="facultyForm">
                    <div class="form-group">
                        <label for="facultyName">Full Name:</label>
                        <input type="text" id="facultyName" required>
                    </div>
                    <div class="form-group">
                        <label for="facultyEmail">Email:</label>
                        <input type="email" id="facultyEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="facultyPhone">Phone:</label>
                        <input type="tel" id="facultyPhone">
                    </div>
                    <div class="form-group">
                        <label for="facultyDepartment">Department:</label>
                        <input type="text" id="facultyDepartment" required>
                    </div>
                    <div class="form-group">
                        <label for="facultySubjects">Subjects (comma-separated):</label>
                        <input type="text" id="facultySubjects" placeholder="e.g., Mathematics, Physics">
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn--secondary" onclick="closeFacultyModal()">Cancel</button>
                        <button type="submit" class="btn btn--primary">Save Faculty</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- User Management Modal -->
        <div id="userManagementModal" class="modal">
            <div class="modal-content user-management-modal">
                <h3>User Management</h3>
                <div class="user-tabs">
                    <button class="user-tab-btn active" data-user-tab="pending">Pending Users <span id="pendingCountTab" class="badge">0</span></button>
                    <button class="user-tab-btn" data-user-tab="approved">Approved Users</button>
                </div>
                <div class="user-tab-content active" id="pending-users">
                    <div id="pendingUsersList" class="user-list">
                        <p class="empty-state">No pending user requests</p>
                    </div>
                </div>
                <div class="user-tab-content" id="approved-users">
                    <div id="approvedUsersList" class="user-list">
                        <p class="empty-state">No approved users</p>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" onclick="closeUserManagement()">Close</button>
                </div>
            </div>
        </div>

        <!-- Print Layout -->
        <div id="printLayout" class="print-layout">
            <div class="print-header">
                <h1>Institute Lab Management System</h1>
                <h2>Lab Assignment Schedule</h2>
                <p class="print-date">Generated on: <span id="printDate"></span></p>
            </div>
            <div id="printGrid" class="print-grid">
                <p class="empty-state">No assignments to print.</p>
            </div>
            <div class="print-footer">
                <p>For any queries, contact the Lab Coordinator</p>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script src="sync-helper.js"></script>
    <script src="app.js"></script>
</body>
</html>
