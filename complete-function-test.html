<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAMS - Complete Function Testing Suite</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .test-name {
            font-weight: 500;
            flex: 1;
        }
        .test-status {
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: bold;
            min-width: 80px;
            text-align: center;
        }
        .status-pass { background: #d4edda; color: #155724; }
        .status-fail { background: #f8d7da; color: #721c24; }
        .status-warning { background: #fff3cd; color: #856404; }
        .status-info { background: #d1ecf1; color: #0c5460; }
        .status-testing { background: #e2e3e5; color: #383d41; }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover { background: #0056b3; }
        .test-button:disabled { background: #6c757d; cursor: not-allowed; }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .section-title {
            color: #333;
            margin: 0;
        }
        .section-stats {
            font-size: 14px;
            color: #666;
        }
        
        .logs {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background-color: #28a745;
            transition: width 0.3s ease;
        }
        
        .summary-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .test-controls {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>🧪 LAMS Complete Function Testing Suite</h1>
    
    <div class="summary-card">
        <h2>System Health Status</h2>
        <div id="overallProgress" class="progress-bar">
            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
        </div>
        <div id="overallStats">Ready to start testing...</div>
    </div>

    <div class="test-controls">
        <button class="test-button" onclick="runAllTests()" id="runAllBtn">🚀 Run All Tests</button>
        <button class="test-button" onclick="runQuickTest()">⚡ Quick Test</button>
        <button class="test-button" onclick="clearLogs()">🗑️ Clear Logs</button>
        <button class="test-button" onclick="exportResults()">📊 Export Results</button>
    </div>

    <!-- 1. Core System Functions -->
    <div class="test-section">
        <div class="section-header">
            <h3 class="section-title">🏗️ Core System Functions</h3>
            <div class="section-stats" id="coreStats">0/0 tested</div>
        </div>
        <div id="coreTests"></div>
        <button class="test-button" onclick="testCoreSystem()">Test Core System</button>
    </div>

    <!-- 2. Authentication Functions -->
    <div class="test-section">
        <div class="section-header">
            <h3 class="section-title">🔐 Authentication Functions</h3>
            <div class="section-stats" id="authStats">0/0 tested</div>
        </div>
        <div id="authTests"></div>
        <button class="test-button" onclick="testAuthSystem()">Test Authentication</button>
    </div>

    <!-- 3. Data Management Functions -->
    <div class="test-section">
        <div class="section-header">
            <h3 class="section-title">💾 Data Management Functions</h3>
            <div class="section-stats" id="dataStats">0/0 tested</div>
        </div>
        <div id="dataTests"></div>
        <button class="test-button" onclick="testDataManagement()">Test Data Management</button>
    </div>

    <!-- 4. CRUD Operations -->
    <div class="test-section">
        <div class="section-header">
            <h3 class="section-title">📝 CRUD Operations</h3>
            <div class="section-stats" id="crudStats">0/0 tested</div>
        </div>
        <div id="crudTests"></div>
        <button class="test-button" onclick="testCRUDOperations()">Test CRUD Operations</button>
    </div>

    <!-- 5. Sync System Functions -->
    <div class="test-section">
        <div class="section-header">
            <h3 class="section-title">🔄 Sync System Functions</h3>
            <div class="section-stats" id="syncStats">0/0 tested</div>
        </div>
        <div id="syncTests"></div>
        <button class="test-button" onclick="testSyncSystem()">Test Sync System</button>
    </div>

    <!-- 6. Analytics Functions -->
    <div class="test-section">
        <div class="section-header">
            <h3 class="section-title">📊 Analytics Functions</h3>
            <div class="section-stats" id="analyticsStats">0/0 tested</div>
        </div>
        <div id="analyticsTests"></div>
        <button class="test-button" onclick="testAnalytics()">Test Analytics</button>
    </div>

    <!-- 7. UI Functions -->
    <div class="test-section">
        <div class="section-header">
            <h3 class="section-title">🎨 UI Functions</h3>
            <div class="section-stats" id="uiStats">0/0 tested</div>
        </div>
        <div id="uiTests"></div>
        <button class="test-button" onclick="testUIFunctions()">Test UI Functions</button>
    </div>

    <!-- 8. Utility Functions -->
    <div class="test-section">
        <div class="section-header">
            <h3 class="section-title">🔧 Utility Functions</h3>
            <div class="section-stats" id="utilityStats">0/0 tested</div>
        </div>
        <div id="utilityTests"></div>
        <button class="test-button" onclick="testUtilityFunctions()">Test Utilities</button>
    </div>

    <!-- Test Logs -->
    <div class="test-section">
        <h3>📝 Test Logs</h3>
        <div class="logs" id="testLogs"></div>
    </div>

    <!-- External Libraries -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.min.js"></script>
    
    <!-- Application Scripts -->
    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script src="sync-helper.js"></script>
    <script src="app.js"></script>

    <script>
        // Global test state
        let testResults = {
            core: {},
            auth: {},
            data: {},
            crud: {},
            sync: {},
            analytics: {},
            ui: {},
            utility: {}
        };
        
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logOutput = document.getElementById('testLogs');
            const typeIcon = {
                'pass': '✅',
                'fail': '❌',
                'warning': '⚠️',
                'info': 'ℹ️',
                'testing': '🧪'
            };
            logOutput.innerHTML += `[${timestamp}] ${typeIcon[type]} ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function createTestItem(name, status, description = '') {
            return `
                <div class="test-item">
                    <div class="test-name">${name}</div>
                    <div class="test-status status-${status}">${status.toUpperCase()}</div>
                </div>
            `;
        }

        function updateStats(sectionId, passed, total) {
            document.getElementById(sectionId).textContent = `${passed}/${total} passed`;
            
            // Update overall progress
            testStats.total = Object.values(testResults).reduce((acc, section) => {
                return acc + Object.keys(section).length;
            }, 0);
            
            testStats.passed = Object.values(testResults).reduce((acc, section) => {
                return acc + Object.values(section).filter(result => result === 'pass').length;
            }, 0);
            
            testStats.failed = Object.values(testResults).reduce((acc, section) => {
                return acc + Object.values(section).filter(result => result === 'fail').length;
            }, 0);
            
            testStats.warnings = Object.values(testResults).reduce((acc, section) => {
                return acc + Object.values(section).filter(result => result === 'warning').length;
            }, 0);
            
            const progressPercent = testStats.total > 0 ? (testStats.passed / testStats.total) * 100 : 0;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('overallStats').innerHTML = 
                `${testStats.passed}/${testStats.total} tests passed | ${testStats.failed} failed | ${testStats.warnings} warnings`;
        }

        function testFunction(name, testFn, category) {
            try {
                log(`Testing ${name}...`, 'testing');
                const result = testFn();
                if (result === true) {
                    testResults[category][name] = 'pass';
                    log(`${name}: PASSED`, 'pass');
                    return 'pass';
                } else if (result === 'warning') {
                    testResults[category][name] = 'warning';
                    log(`${name}: WARNING - ${result}`, 'warning');
                    return 'warning';
                } else {
                    testResults[category][name] = 'fail';
                    log(`${name}: FAILED - ${result}`, 'fail');
                    return 'fail';
                }
            } catch (error) {
                testResults[category][name] = 'fail';
                log(`${name}: FAILED - ${error.message}`, 'fail');
                return 'fail';
            }
        }

        function testCoreSystem() {
            log('Starting Core System Function Tests...', 'info');
            let html = '';
            let passed = 0;
            
            const coreTests = [
                {
                    name: 'DataManager Initialization',
                    test: () => window.dataManager && typeof window.dataManager === 'object'
                },
                {
                    name: 'AuthManager Initialization',
                    test: () => window.authManager && typeof window.authManager === 'object'
                },
                {
                    name: 'NotificationManager Initialization',
                    test: () => window.notificationManager && typeof window.notificationManager === 'object'
                },
                {
                    name: 'Google APIs Loading',
                    test: () => typeof gapi !== 'undefined'
                },
                {
                    name: 'Chart.js Loading',
                    test: () => typeof Chart !== 'undefined'
                },
                {
                    name: 'Data Structure Initialization',
                    test: () => window.dataManager && window.dataManager.data && typeof window.dataManager.data === 'object'
                },
                {
                    name: 'Config Loading',
                    test: () => typeof window.GOOGLE_CONFIG !== 'undefined' && window.GOOGLE_CONFIG.CLIENT_ID
                },
                {
                    name: 'DOM Ready State',
                    test: () => document.readyState === 'complete'
                }
            ];
            
            coreTests.forEach(test => {
                const result = testFunction(test.name, test.test, 'core');
                html += createTestItem(test.name, result);
                if (result === 'pass') passed++;
            });
            
            document.getElementById('coreTests').innerHTML = html;
            updateStats('coreStats', passed, coreTests.length);
            log(`Core System Tests Complete: ${passed}/${coreTests.length} passed`, 'info');
        }

        function testAuthSystem() {
            log('Starting Authentication Function Tests...', 'info');
            let html = '';
            let passed = 0;
            
            const authTests = [
                {
                    name: 'signIn Method',
                    test: () => window.authManager && typeof window.authManager.signIn === 'function'
                },
                {
                    name: 'signOut Method',
                    test: () => window.authManager && typeof window.authManager.signOut === 'function'
                },
                {
                    name: 'getAccessToken Method',
                    test: () => window.authManager && typeof window.authManager.getAccessToken === 'function'
                },
                {
                    name: 'getUserInfo Method',
                    test: () => window.authManager && typeof window.authManager.getUserInfo === 'function'
                },
                {
                    name: 'updateUI Method',
                    test: () => window.authManager && typeof window.authManager.updateUI === 'function'
                },
                {
                    name: 'saveToGoogleDrive Method',
                    test: () => window.authManager && typeof window.authManager.saveToGoogleDrive === 'function'
                },
                {
                    name: 'loadFromDrive Method',
                    test: () => window.authManager && typeof window.authManager.loadFromDrive === 'function'
                },
                {
                    name: 'getUserInfo Functionality',
                    test: () => {
                        if (!window.authManager) return false;
                        try {
                            const userInfo = window.authManager.getUserInfo();
                            return userInfo === null || typeof userInfo === 'object';
                        } catch (error) {
                            return false;
                        }
                    }
                }
            ];
            
            authTests.forEach(test => {
                const result = testFunction(test.name, test.test, 'auth');
                html += createTestItem(test.name, result);
                if (result === 'pass') passed++;
            });
            
            document.getElementById('authTests').innerHTML = html;
            updateStats('authStats', passed, authTests.length);
            log(`Authentication Tests Complete: ${passed}/${authTests.length} passed`, 'info');
        }

        function testDataManagement() {
            log('Starting Data Management Function Tests...', 'info');
            let html = '';
            let passed = 0;
            
            const dataTests = [
                {
                    name: 'assignments Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.assignments)
                },
                {
                    name: 'subjects Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.subjects)
                },
                {
                    name: 'faculties Object',
                    test: () => window.dataManager && window.dataManager.faculties && typeof window.dataManager.faculties === 'object'
                },
                {
                    name: 'periods Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.periods)
                },
                {
                    name: 'branches Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.branches)
                },
                {
                    name: 'days Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.days)
                },
                {
                    name: 'timeSlots Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.timeSlots)
                },
                {
                    name: 'departments Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.departments)
                },
                {
                    name: 'semesters Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.semesters)
                },
                {
                    name: 'groups Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.groups)
                },
                {
                    name: 'subGroups Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.subGroups)
                },
                {
                    name: 'labRooms Array',
                    test: () => window.dataManager && Array.isArray(window.dataManager.labRooms)
                },
                {
                    name: 'Data Validation',
                    test: () => {
                        if (!window.dataManager) return false;
                        const dm = window.dataManager;
                        return dm.data && typeof dm.data === 'object' && 
                               dm.data.academicYear && dm.data.version !== undefined;
                    }
                }
            ];
            
            dataTests.forEach(test => {
                const result = testFunction(test.name, test.test, 'data');
                html += createTestItem(test.name, result);
                if (result === 'pass') passed++;
            });
            
            document.getElementById('dataTests').innerHTML = html;
            updateStats('dataStats', passed, dataTests.length);
            log(`Data Management Tests Complete: ${passed}/${dataTests.length} passed`, 'info');
        }

        function testCRUDOperations() {
            log('Starting CRUD Operations Function Tests...', 'info');
            let html = '';
            let passed = 0;
            
            const crudTests = [
                {
                    name: 'addAssignment Method',
                    test: () => window.dataManager && typeof window.dataManager.addAssignment === 'function'
                },
                {
                    name: 'removeAssignment Method',
                    test: () => window.dataManager && typeof window.dataManager.removeAssignment === 'function'
                },
                {
                    name: 'addMasterDataItem Method',
                    test: () => window.dataManager && typeof window.dataManager.addMasterDataItem === 'function'
                },
                {
                    name: 'removeMasterDataItem Method',
                    test: () => window.dataManager && typeof window.dataManager.removeMasterDataItem === 'function'
                },
                {
                    name: 'addFaculty Method',
                    test: () => window.dataManager && typeof window.dataManager.addFaculty === 'function'
                },
                {
                    name: 'removeFaculty Method',
                    test: () => window.dataManager && typeof window.dataManager.removeFaculty === 'function'
                },
                {
                    name: 'isItemInUse Method',
                    test: () => window.dataManager && typeof window.dataManager.isItemInUse === 'function'
                },
                {
                    name: 'validateMasterDataIntegrity Method',
                    test: () => window.dataManager && typeof window.dataManager.validateMasterDataIntegrity === 'function'
                },
                {
                    name: 'Global addMasterDataItem',
                    test: () => typeof window.addMasterDataItem === 'function'
                },
                {
                    name: 'Global deleteMasterDataItem',
                    test: () => typeof window.deleteMasterDataItem === 'function'
                },
                {
                    name: 'Global addFaculty',
                    test: () => typeof window.addFaculty === 'function'
                },
                {
                    name: 'Global deleteFaculty',
                    test: () => typeof window.deleteFaculty === 'function'
                },
                {
                    name: 'Global deleteAssignment',
                    test: () => typeof window.deleteAssignment === 'function'
                }
            ];
            
            crudTests.forEach(test => {
                const result = testFunction(test.name, test.test, 'crud');
                html += createTestItem(test.name, result);
                if (result === 'pass') passed++;
            });
            
            document.getElementById('crudTests').innerHTML = html;
            updateStats('crudStats', passed, crudTests.length);
            log(`CRUD Operations Tests Complete: ${passed}/${crudTests.length} passed`, 'info');
        }

        function testSyncSystem() {
            log('Starting Sync System Function Tests...', 'info');
            let html = '';
            let passed = 0;
            
            const syncTests = [
                {
                    name: 'startRealTimeSync Method',
                    test: () => window.dataManager && typeof window.dataManager.startRealTimeSync === 'function'
                },
                {
                    name: 'stopRealTimeSync Method',
                    test: () => window.dataManager && typeof window.dataManager.stopRealTimeSync === 'function'
                },
                {
                    name: 'syncWithCloud Method',
                    test: () => window.dataManager && typeof window.dataManager.syncWithCloud === 'function'
                },
                {
                    name: 'shouldSkipSync Method',
                    test: () => window.dataManager && typeof window.dataManager.shouldSkipSync === 'function'
                },
                {
                    name: 'setupAdvancedInteractionTracking Method',
                    test: () => window.dataManager && typeof window.dataManager.setupAdvancedInteractionTracking === 'function'
                },
                {
                    name: 'save Method',
                    test: () => window.dataManager && typeof window.dataManager.save === 'function'
                },
                {
                    name: 'loadFromCloud Method',
                    test: () => window.dataManager && typeof window.dataManager.loadFromCloud === 'function'
                },
                {
                    name: 'initializeDefaultData Method',
                    test: () => window.dataManager && typeof window.dataManager.initializeDefaultData === 'function'
                },
                {
                    name: 'updateSyncStatus Method',
                    test: () => window.dataManager && typeof window.dataManager.updateSyncStatus === 'function'
                },
                {
                    name: 'triggerImmediateSync Method',
                    test: () => window.dataManager && typeof window.dataManager.triggerImmediateSync === 'function'
                },
                {
                    name: 'Dropdown Detection Variables',
                    test: () => window.dataManager && 
                              typeof window.dataManager.isDropdownOpen !== 'undefined' &&
                              typeof window.dataManager.isFormActive !== 'undefined'
                }
            ];
            
            syncTests.forEach(test => {
                const result = testFunction(test.name, test.test, 'sync');
                html += createTestItem(test.name, result);
                if (result === 'pass') passed++;
            });
            
            document.getElementById('syncTests').innerHTML = html;
            updateStats('syncStats', passed, syncTests.length);
            log(`Sync System Tests Complete: ${passed}/${syncTests.length} passed`, 'info');
        }

        function testAnalytics() {
            log('Starting Analytics Function Tests...', 'info');
            let html = '';
            let passed = 0;
            
            const analyticsTests = [
                {
                    name: 'generateSubjectAssignmentChart',
                    test: () => typeof window.generateSubjectAssignmentChart === 'function'
                },
                {
                    name: 'generateFacultyWorkloadChart',
                    test: () => typeof window.generateFacultyWorkloadChart === 'function'
                },
                {
                    name: 'generateAssignmentStatusChart',
                    test: () => typeof window.generateAssignmentStatusChart === 'function'
                },
                {
                    name: 'generateWeeklyDistributionChart',
                    test: () => typeof window.generateWeeklyDistributionChart === 'function'
                },
                {
                    name: 'generateSubjectFacultyChart',
                    test: () => typeof window.generateSubjectFacultyChart === 'function'
                },
                {
                    name: 'generateCompletionRateChart',
                    test: () => typeof window.generateCompletionRateChart === 'function'
                },
                {
                    name: 'generateTimelineChart',
                    test: () => typeof window.generateTimelineChart === 'function'
                },
                {
                    name: 'generateWorkloadHeatmap',
                    test: () => typeof window.generateWorkloadHeatmap === 'function'
                },
                {
                    name: 'Chart.js Library',
                    test: () => typeof Chart !== 'undefined'
                },
                {
                    name: 'Analytics Tab Element',
                    test: () => document.getElementById('analytics') !== null
                }
            ];
            
            analyticsTests.forEach(test => {
                const result = testFunction(test.name, test.test, 'analytics');
                html += createTestItem(test.name, result);
                if (result === 'pass') passed++;
            });
            
            document.getElementById('analyticsTests').innerHTML = html;
            updateStats('analyticsStats', passed, analyticsTests.length);
            log(`Analytics Tests Complete: ${passed}/${analyticsTests.length} passed`, 'info');
        }

        function testUIFunctions() {
            log('Starting UI Function Tests...', 'info');
            let html = '';
            let passed = 0;
            
            const uiTests = [
                {
                    name: 'showTab Function',
                    test: () => typeof window.showTab === 'function'
                },
                {
                    name: 'showUserManagement Function',
                    test: () => typeof window.showUserManagement === 'function'
                },
                {
                    name: 'editAcademicYear Function',
                    test: () => typeof window.editAcademicYear === 'function'
                },
                {
                    name: 'toggleScheduleOrientation Function',
                    test: () => typeof window.toggleScheduleOrientation === 'function'
                },
                {
                    name: 'previewAssignment Function',
                    test: () => typeof window.previewAssignment === 'function'
                },
                {
                    name: 'updateSearchStats Function',
                    test: () => typeof window.updateSearchStats === 'function'
                },
                {
                    name: 'clearAllData Function',
                    test: () => typeof window.clearAllData === 'function'
                },
                {
                    name: 'updateAdminStats Function',
                    test: () => typeof window.updateAdminStats === 'function'
                },
                {
                    name: 'refreshSyncLogs Function',
                    test: () => typeof window.refreshSyncLogs === 'function'
                },
                {
                    name: 'Main Navigation Elements',
                    test: () => document.getElementById('main-nav') !== null
                },
                {
                    name: 'Tab Content Elements',
                    test: () => document.querySelectorAll('.tab-content').length > 0
                }
            ];
            
            uiTests.forEach(test => {
                const result = testFunction(test.name, test.test, 'ui');
                html += createTestItem(test.name, result);
                if (result === 'pass') passed++;
            });
            
            document.getElementById('uiTests').innerHTML = html;
            updateStats('uiStats', passed, uiTests.length);
            log(`UI Function Tests Complete: ${passed}/${uiTests.length} passed`, 'info');
        }

        function testUtilityFunctions() {
            log('Starting Utility Function Tests...', 'info');
            let html = '';
            let passed = 0;
            
            const utilityTests = [
                {
                    name: 'exportData Function',
                    test: () => typeof window.exportData === 'function'
                },
                {
                    name: 'importData Function',
                    test: () => typeof window.importData === 'function'
                },
                {
                    name: 'getFacultyShortNames Method',
                    test: () => window.dataManager && typeof window.dataManager.getFacultyShortNames === 'function'
                },
                {
                    name: 'getFacultyDisplayNames Method',
                    test: () => window.dataManager && typeof window.dataManager.getFacultyDisplayNames === 'function'
                },
                {
                    name: 'setAcademicYear Method',
                    test: () => window.dataManager && typeof window.dataManager.setAcademicYear === 'function'
                },
                {
                    name: 'refreshAllComponents Method',
                    test: () => window.dataManager && typeof window.dataManager.refreshAllComponents === 'function'
                },
                {
                    name: 'showMessage Function',
                    test: () => typeof window.showMessage === 'function'
                },
                {
                    name: 'NotificationManager Functions',
                    test: () => window.notificationManager && 
                              typeof window.notificationManager.show === 'function'
                }
            ];
            
            utilityTests.forEach(test => {
                const result = testFunction(test.name, test.test, 'utility');
                html += createTestItem(test.name, result);
                if (result === 'pass') passed++;
            });
            
            document.getElementById('utilityTests').innerHTML = html;
            updateStats('utilityStats', passed, utilityTests.length);
            log(`Utility Function Tests Complete: ${passed}/${utilityTests.length} passed`, 'info');
        }

        function runAllTests() {
            log('Starting Complete Function Testing Suite...', 'info');
            document.getElementById('runAllBtn').disabled = true;
            document.getElementById('runAllBtn').textContent = 'Running Tests...';
            
            setTimeout(() => testCoreSystem(), 100);
            setTimeout(() => testAuthSystem(), 300);
            setTimeout(() => testDataManagement(), 500);
            setTimeout(() => testCRUDOperations(), 700);
            setTimeout(() => testSyncSystem(), 900);
            setTimeout(() => testAnalytics(), 1100);
            setTimeout(() => testUIFunctions(), 1300);
            setTimeout(() => testUtilityFunctions(), 1500);
            
            setTimeout(() => {
                log('Complete Function Testing Suite Finished!', 'info');
                log(`Final Results: ${testStats.passed}/${testStats.total} functions working correctly`, 'info');
                document.getElementById('runAllBtn').disabled = false;
                document.getElementById('runAllBtn').textContent = '🚀 Run All Tests';
                
                if (testStats.passed === testStats.total) {
                    log('🎉 ALL FUNCTIONS ARE WORKING PERFECTLY!', 'pass');
                } else if (testStats.passed > testStats.total * 0.8) {
                    log('⚠️ Most functions working, some issues detected', 'warning');
                } else {
                    log('❌ Multiple function failures detected', 'fail');
                }
            }, 1700);
        }

        function runQuickTest() {
            log('Running Quick Test...', 'info');
            const criticalFunctions = [
                () => window.dataManager !== undefined,
                () => window.authManager !== undefined,
                () => typeof Chart !== 'undefined',
                () => Array.isArray(window.dataManager?.assignments),
                () => typeof window.dataManager?.startRealTimeSync === 'function'
            ];
            
            const passed = criticalFunctions.filter(test => test()).length;
            log(`Quick Test: ${passed}/${criticalFunctions.length} critical functions working`, 
                passed === criticalFunctions.length ? 'pass' : 'warning');
        }

        function clearLogs() {
            document.getElementById('testLogs').innerHTML = '';
            log('Test logs cleared', 'info');
        }

        function exportResults() {
            const results = {
                timestamp: new Date().toISOString(),
                stats: testStats,
                results: testResults,
                summary: `${testStats.passed}/${testStats.total} functions working`
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lams-function-test-results-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('Test results exported', 'info');
        }

        // Auto-run tests when page loads
        window.addEventListener('load', function() {
            log('Complete Function Testing Suite loaded', 'info');
            setTimeout(() => {
                log('Auto-running initial tests...', 'info');
                runAllTests();
            }, 2000);
        });
    </script>
</body>
</html>
