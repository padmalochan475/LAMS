<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAMS - Comprehensive Functionality Test</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .test-section {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        .test-section.success { border-color: #4caf50; background: #f1f8e9; }
        .test-section.warning { border-color: #ff9800; background: #fff3e0; }
        .test-section.error { border-color: #f44336; background: #ffebee; }
        .test-section.testing { border-color: #2196f3; background: #e3f2fd; }
        
        .test-button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-button.primary { background: #4285f4; color: white; }
        .test-button.secondary { background: #f0f0f0; color: #333; }
        .test-button:hover { opacity: 0.8; }
        
        .test-result {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .status-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }
        .status-success { background: #4caf50; }
        .status-warning { background: #ff9800; }
        .status-error { background: #f44336; }
        .status-info { background: #2196f3; }
        .status-pending { background: #9e9e9e; }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-status {
            float: right;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç LAMS - Comprehensive Functionality Test</h1>
        <p>Testing all features after sync system improvements</p>
        
        <div class="test-grid">
            <!-- Core System Test -->
            <div class="test-section" id="coreSection">
                <h3>üèóÔ∏è Core System</h3>
                <button class="test-button primary" onclick="testCoreSystem()">Test Core Functions</button>
                <div class="test-result" id="coreResult">Ready to test core system...</div>
            </div>

            <!-- Authentication Test -->
            <div class="test-section" id="authSection">
                <h3>üîê Authentication</h3>
                <button class="test-button primary" onclick="testAuthentication()">Test Auth System</button>
                <button class="test-button secondary" onclick="testSignOut()">Test Sign Out</button>
                <div class="test-result" id="authResult">Ready to test authentication...</div>
            </div>

            <!-- Data Management Test -->
            <div class="test-section" id="dataSection">
                <h3>üíæ Data Management</h3>
                <button class="test-button primary" onclick="testDataOperations()">Test Data CRUD</button>
                <button class="test-button secondary" onclick="testDataValidation()">Test Validation</button>
                <div class="test-result" id="dataResult">Ready to test data operations...</div>
            </div>

            <!-- Sync System Test -->
            <div class="test-section" id="syncSection">
                <h3>üîÑ Smart Sync System</h3>
                <button class="test-button primary" onclick="testSyncSystem()">Test Sync Logic</button>
                <button class="test-button secondary" onclick="testDropdownProtection()">Test Dropdown Protection</button>
                <div class="test-result" id="syncResult">Ready to test sync system...</div>
            </div>

            <!-- UI Components Test -->
            <div class="test-section" id="uiSection">
                <h3>üé® User Interface</h3>
                <button class="test-button primary" onclick="testUIComponents()">Test UI Elements</button>
                <button class="test-button secondary" onclick="testResponsiveness()">Test Responsive Design</button>
                <div class="test-result" id="uiResult">Ready to test UI components...</div>
            </div>

            <!-- Analytics Test -->
            <div class="test-section" id="analyticsSection">
                <h3>üìä Analytics System</h3>
                <button class="test-button primary" onclick="testAnalytics()">Test Analytics Functions</button>
                <button class="test-button secondary" onclick="testChartGeneration()">Test Chart Generation</button>
                <div class="test-result" id="analyticsResult">Ready to test analytics...</div>
            </div>

            <!-- Assignment Management Test -->
            <div class="test-section" id="assignmentSection">
                <h3>üìù Assignment Management</h3>
                <button class="test-button primary" onclick="testAssignmentCRUD()">Test Assignment CRUD</button>
                <button class="test-button secondary" onclick="testScheduleGeneration()">Test Schedule Generation</button>
                <div class="test-result" id="assignmentResult">Ready to test assignments...</div>
            </div>

            <!-- Master Data Test -->
            <div class="test-section" id="masterDataSection">
                <h3>‚öôÔ∏è Master Data</h3>
                <button class="test-button primary" onclick="testMasterData()">Test Master Data CRUD</button>
                <button class="test-button secondary" onclick="testDataIntegrity()">Test Data Integrity</button>
                <div class="test-result" id="masterDataResult">Ready to test master data...</div>
            </div>

            <!-- Print System Test -->
            <div class="test-section" id="printSection">
                <h3>üñ®Ô∏è Print System</h3>
                <button class="test-button primary" onclick="testPrintFunctionality()">Test Print Functions</button>
                <button class="test-button secondary" onclick="testPrintPreview()">Test Print Preview</button>
                <div class="test-result" id="printResult">Ready to test print system...</div>
            </div>
        </div>

        <!-- Overall Status -->
        <div class="test-section" style="margin-top: 30px;" id="overallSection">
            <h3>üìã Overall Test Results</h3>
            <button class="test-button primary" onclick="runAllTests()">üöÄ Run All Tests</button>
            <button class="test-button secondary" onclick="generateReport()">üìÑ Generate Report</button>
            <div class="test-result" id="overallResult">Click "Run All Tests" to begin comprehensive testing...</div>
        </div>
    </div>

    <!-- Include Application Scripts -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.min.js"></script>
    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script src="app.js"></script>

    <script>
        // Test Results Storage
        const testResults = {};
        
        // Helper Functions
        function updateTestStatus(sectionId, status) {
            const section = document.getElementById(sectionId);
            section.className = `test-section ${status}`;
        }
        
        function logResult(resultId, message, status = 'info') {
            const resultDiv = document.getElementById(resultId);
            const timestamp = new Date().toLocaleTimeString();
            const statusIcon = `<span class="status-icon status-${status}"></span>`;
            resultDiv.innerHTML += `${statusIcon}[${timestamp}] ${message}\n`;
            resultDiv.scrollTop = resultDiv.scrollHeight;
        }
        
        function clearResult(resultId) {
            document.getElementById(resultId).innerHTML = '';
        }

        // Core System Tests
        async function testCoreSystem() {
            clearResult('coreResult');
            updateTestStatus('coreSection', 'testing');
            logResult('coreResult', 'Testing core system components...', 'info');
            
            try {
                // Test if core objects exist
                const tests = [
                    { name: 'DataManager', obj: window.dataManager, critical: true },
                    { name: 'AuthManager', obj: window.authManager, critical: true },
                    { name: 'NotificationManager', obj: window.notificationManager, critical: false },
                    { name: 'Google APIs', obj: window.gapi, critical: true },
                    { name: 'Chart.js', obj: window.Chart, critical: false }
                ];
                
                let passed = 0;
                let failed = 0;
                
                for (const test of tests) {
                    if (test.obj) {
                        logResult('coreResult', `‚úÖ ${test.name}: Available`, 'success');
                        passed++;
                    } else {
                        logResult('coreResult', `‚ùå ${test.name}: Missing${test.critical ? ' (CRITICAL)' : ''}`, test.critical ? 'error' : 'warning');
                        failed++;
                    }
                }
                
                // Test basic functionality
                if (window.dataManager) {
                    const hasData = window.dataManager.assignments !== undefined;
                    logResult('coreResult', `Data Structure: ${hasData ? 'Initialized' : 'Not Initialized'}`, hasData ? 'success' : 'warning');
                }
                
                testResults.core = { passed, failed, total: tests.length };
                updateTestStatus('coreSection', failed === 0 ? 'success' : (passed > failed ? 'warning' : 'error'));
                logResult('coreResult', `Core System Test Complete: ${passed}/${tests.length} passed`, failed === 0 ? 'success' : 'warning');
                
            } catch (error) {
                logResult('coreResult', `Core System Test Failed: ${error.message}`, 'error');
                updateTestStatus('coreSection', 'error');
                testResults.core = { error: error.message };
            }
        }

        // Authentication Tests
        async function testAuthentication() {
            clearResult('authResult');
            updateTestStatus('authSection', 'testing');
            logResult('authResult', 'Testing authentication system...', 'info');
            
            try {
                if (window.authManager) {
                    const isSignedIn = window.authManager.isSignedIn;
                    logResult('authResult', `Auth Status: ${isSignedIn ? 'Signed In' : 'Not Signed In'}`, isSignedIn ? 'success' : 'info');
                    
                    // Test auth methods availability
                    const methods = ['signIn', 'signOut', 'getAccessToken', 'getUserInfo'];
                    let methodsAvailable = 0;
                    
                    methods.forEach(method => {
                        if (typeof window.authManager[method] === 'function') {
                            logResult('authResult', `‚úÖ Method ${method}: Available`, 'success');
                            methodsAvailable++;
                        } else {
                            logResult('authResult', `‚ùå Method ${method}: Missing`, 'error');
                        }
                    });
                    
                    testResults.auth = { methodsAvailable, totalMethods: methods.length, isSignedIn };
                    updateTestStatus('authSection', methodsAvailable === methods.length ? 'success' : 'warning');
                    
                } else {
                    logResult('authResult', 'AuthManager not available', 'error');
                    updateTestStatus('authSection', 'error');
                    testResults.auth = { error: 'AuthManager not available' };
                }
            } catch (error) {
                logResult('authResult', `Authentication Test Failed: ${error.message}`, 'error');
                updateTestStatus('authSection', 'error');
                testResults.auth = { error: error.message };
            }
        }

        // Sync System Tests
        async function testSyncSystem() {
            clearResult('syncResult');
            updateTestStatus('syncSection', 'testing');
            logResult('syncResult', 'Testing smart sync system...', 'info');
            
            try {
                if (window.dataManager) {
                    // Test sync methods
                    const syncMethods = ['startRealTimeSync', 'stopRealTimeSync', 'syncWithCloud', 'shouldSkipSync'];
                    let availableMethods = 0;
                    
                    syncMethods.forEach(method => {
                        if (typeof window.dataManager[method] === 'function') {
                            logResult('syncResult', `‚úÖ Sync Method ${method}: Available`, 'success');
                            availableMethods++;
                        } else {
                            logResult('syncResult', `‚ùå Sync Method ${method}: Missing`, 'error');
                        }
                    });
                    
                    // Test sync interval
                    if (window.dataManager.syncInterval) {
                        logResult('syncResult', '‚úÖ Sync interval is active', 'success');
                    } else {
                        logResult('syncResult', '‚ö†Ô∏è Sync interval not active (may need authentication)', 'warning');
                    }
                    
                    // Test activity tracking
                    const hasActivityTracking = window.dataManager.lastUserActivity !== undefined;
                    logResult('syncResult', `Activity Tracking: ${hasActivityTracking ? 'Active' : 'Inactive'}`, hasActivityTracking ? 'success' : 'warning');
                    
                    testResults.sync = { availableMethods, totalMethods: syncMethods.length, hasActivityTracking };
                    updateTestStatus('syncSection', availableMethods === syncMethods.length ? 'success' : 'warning');
                    
                } else {
                    logResult('syncResult', 'DataManager not available for sync testing', 'error');
                    updateTestStatus('syncSection', 'error');
                    testResults.sync = { error: 'DataManager not available' };
                }
            } catch (error) {
                logResult('syncResult', `Sync System Test Failed: ${error.message}`, 'error');
                updateTestStatus('syncSection', 'error');
                testResults.sync = { error: error.message };
            }
        }

        // Dropdown Protection Test
        async function testDropdownProtection() {
            clearResult('syncResult');
            logResult('syncResult', 'Testing dropdown protection system...', 'info');
            
            try {
                if (window.dataManager && typeof window.dataManager.shouldSkipSync === 'function') {
                    // Create a test dropdown
                    const testSelect = document.createElement('select');
                    testSelect.id = 'testDropdown';
                    testSelect.innerHTML = '<option>Test Option 1</option><option>Test Option 2</option>';
                    document.body.appendChild(testSelect);
                    
                    // Test dropdown detection
                    testSelect.focus();
                    const shouldSkipWhenFocused = window.dataManager.shouldSkipSync();
                    
                    testSelect.blur();
                    setTimeout(() => {
                        const shouldNotSkipWhenBlurred = !window.dataManager.shouldSkipSync();
                        
                        logResult('syncResult', `Dropdown Focus Detection: ${shouldSkipWhenFocused ? 'Working' : 'Not Working'}`, shouldSkipWhenFocused ? 'success' : 'error');
                        logResult('syncResult', `Dropdown Blur Detection: ${shouldNotSkipWhenBlurred ? 'Working' : 'Not Working'}`, shouldNotSkipWhenBlurred ? 'success' : 'warning');
                        
                        document.body.removeChild(testSelect);
                        
                        const protectionWorking = shouldSkipWhenFocused;
                        updateTestStatus('syncSection', protectionWorking ? 'success' : 'warning');
                        logResult('syncResult', `Dropdown Protection: ${protectionWorking ? 'ACTIVE' : 'NEEDS ATTENTION'}`, protectionWorking ? 'success' : 'warning');
                        
                    }, 100);
                    
                } else {
                    logResult('syncResult', 'Dropdown protection function not available', 'error');
                }
            } catch (error) {
                logResult('syncResult', `Dropdown Protection Test Failed: ${error.message}`, 'error');
            }
        }

        // Analytics Tests
        async function testAnalytics() {
            clearResult('analyticsResult');
            updateTestStatus('analyticsSection', 'testing');
            logResult('analyticsResult', 'Testing analytics system...', 'info');
            
            try {
                const analyticsFunctions = [
                    'generateSubjectAssignmentChart',
                    'generateFacultyWorkloadChart',
                    'generateAssignmentStatusChart',
                    'generateWeeklyDistributionChart',
                    'generateSubjectFacultyChart',
                    'generateCompletionRateChart',
                    'generateTimelineChart',
                    'generateWorkloadHeatmap'
                ];
                
                let availableFunctions = 0;
                
                analyticsFunctions.forEach(func => {
                    if (typeof window[func] === 'function') {
                        logResult('analyticsResult', `‚úÖ ${func}: Available`, 'success');
                        availableFunctions++;
                    } else {
                        logResult('analyticsResult', `‚ùå ${func}: Missing`, 'error');
                    }
                });
                
                // Test Chart.js availability
                const chartJsAvailable = typeof Chart !== 'undefined';
                logResult('analyticsResult', `Chart.js Library: ${chartJsAvailable ? 'Available' : 'Missing'}`, chartJsAvailable ? 'success' : 'error');
                
                testResults.analytics = { availableFunctions, totalFunctions: analyticsFunctions.length, chartJsAvailable };
                const allWorking = availableFunctions === analyticsFunctions.length && chartJsAvailable;
                updateTestStatus('analyticsSection', allWorking ? 'success' : 'warning');
                
                logResult('analyticsResult', `Analytics Test Complete: ${availableFunctions}/${analyticsFunctions.length} functions available`, allWorking ? 'success' : 'warning');
                
            } catch (error) {
                logResult('analyticsResult', `Analytics Test Failed: ${error.message}`, 'error');
                updateTestStatus('analyticsSection', 'error');
                testResults.analytics = { error: error.message };
            }
        }

        // UI Components Test
        async function testUIComponents() {
            clearResult('uiResult');
            updateTestStatus('uiSection', 'testing');
            logResult('uiResult', 'Testing UI components...', 'info');
            
            try {
                // Test tab functionality
                const tabsExist = typeof window.showTab === 'function';
                logResult('uiResult', `Tab System: ${tabsExist ? 'Available' : 'Missing'}`, tabsExist ? 'success' : 'error');
                
                // Test required UI elements
                const uiElements = [
                    { id: 'dashboard-tab', name: 'Dashboard Tab' },
                    { id: 'assignments', name: 'Assignments Tab' },
                    { id: 'master-data', name: 'Master Data Tab' },
                    { id: 'analytics', name: 'Analytics Tab' },
                    { id: 'print', name: 'Print Tab' }
                ];
                
                let elementsFound = 0;
                
                // Check if we're in main app context
                if (window.location.pathname.includes('index.html') || window.location.pathname === '/') {
                    uiElements.forEach(element => {
                        const el = document.getElementById(element.id);
                        if (el) {
                            logResult('uiResult', `‚úÖ ${element.name}: Found`, 'success');
                            elementsFound++;
                        } else {
                            logResult('uiResult', `‚ùå ${element.name}: Missing`, 'warning');
                        }
                    });
                } else {
                    logResult('uiResult', '‚ÑπÔ∏è UI elements test requires main application context', 'info');
                    elementsFound = uiElements.length; // Assume present in main app
                }
                
                testResults.ui = { elementsFound, totalElements: uiElements.length, tabsExist };
                updateTestStatus('uiSection', elementsFound === uiElements.length && tabsExist ? 'success' : 'warning');
                
            } catch (error) {
                logResult('uiResult', `UI Components Test Failed: ${error.message}`, 'error');
                updateTestStatus('uiSection', 'error');
                testResults.ui = { error: error.message };
            }
        }

        // Data Operations Test
        async function testDataOperations() {
            clearResult('dataResult');
            updateTestStatus('dataSection', 'testing');
            logResult('dataResult', 'Testing data operations...', 'info');
            
            try {
                if (window.dataManager) {
                    // Test data structure
                    const dataStructure = {
                        assignments: Array.isArray(window.dataManager.assignments),
                        subjects: Array.isArray(window.dataManager.subjects),
                        faculties: Array.isArray(window.dataManager.faculties),
                        periods: Array.isArray(window.dataManager.periods),
                        branches: Array.isArray(window.dataManager.branches)
                    };
                    
                    let structureValid = 0;
                    Object.entries(dataStructure).forEach(([key, isValid]) => {
                        logResult('dataResult', `${key}: ${isValid ? 'Valid Array' : 'Invalid/Missing'}`, isValid ? 'success' : 'error');
                        if (isValid) structureValid++;
                    });
                    
                    // Test CRUD methods
                    const crudMethods = ['addAssignment', 'removeAssignment', 'addMasterDataItem', 'removeMasterDataItem'];
                    let methodsAvailable = 0;
                    
                    crudMethods.forEach(method => {
                        if (typeof window.dataManager[method] === 'function') {
                            logResult('dataResult', `‚úÖ ${method}: Available`, 'success');
                            methodsAvailable++;
                        } else {
                            logResult('dataResult', `‚ùå ${method}: Missing`, 'error');
                        }
                    });
                    
                    testResults.data = { structureValid, totalStructures: Object.keys(dataStructure).length, methodsAvailable, totalMethods: crudMethods.length };
                    const allValid = structureValid === Object.keys(dataStructure).length && methodsAvailable === crudMethods.length;
                    updateTestStatus('dataSection', allValid ? 'success' : 'warning');
                    
                } else {
                    logResult('dataResult', 'DataManager not available', 'error');
                    updateTestStatus('dataSection', 'error');
                    testResults.data = { error: 'DataManager not available' };
                }
            } catch (error) {
                logResult('dataResult', `Data Operations Test Failed: ${error.message}`, 'error');
                updateTestStatus('dataSection', 'error');
                testResults.data = { error: error.message };
            }
        }

        // Master Data Test
        async function testMasterData() {
            clearResult('masterDataResult');
            updateTestStatus('masterDataSection', 'testing');
            logResult('masterDataResult', 'Testing master data functionality...', 'info');
            
            try {
                // Test master data functions
                const masterDataFunctions = ['addMasterDataItem', 'addFaculty', 'deleteMasterDataItem', 'deleteFaculty'];
                let functionsAvailable = 0;
                
                masterDataFunctions.forEach(func => {
                    if (typeof window[func] === 'function') {
                        logResult('masterDataResult', `‚úÖ ${func}: Available`, 'success');
                        functionsAvailable++;
                    } else {
                        logResult('masterDataResult', `‚ùå ${func}: Missing`, 'error');
                    }
                });
                
                // Test data integrity functions
                if (window.dataManager && typeof window.dataManager.validateMasterDataIntegrity === 'function') {
                    logResult('masterDataResult', '‚úÖ Data integrity validation: Available', 'success');
                } else {
                    logResult('masterDataResult', '‚ùå Data integrity validation: Missing', 'warning');
                }
                
                testResults.masterData = { functionsAvailable, totalFunctions: masterDataFunctions.length };
                updateTestStatus('masterDataSection', functionsAvailable === masterDataFunctions.length ? 'success' : 'warning');
                
            } catch (error) {
                logResult('masterDataResult', `Master Data Test Failed: ${error.message}`, 'error');
                updateTestStatus('masterDataSection', 'error');
                testResults.masterData = { error: error.message };
            }
        }

        // Assignment Management Test
        async function testAssignmentCRUD() {
            clearResult('assignmentResult');
            updateTestStatus('assignmentSection', 'testing');
            logResult('assignmentResult', 'Testing assignment management...', 'info');
            
            try {
                // Test assignment functions
                const assignmentFunctions = ['deleteAssignment', 'previewAssignment'];
                let functionsAvailable = 0;
                
                assignmentFunctions.forEach(func => {
                    if (typeof window[func] === 'function') {
                        logResult('assignmentResult', `‚úÖ ${func}: Available`, 'success');
                        functionsAvailable++;
                    } else {
                        logResult('assignmentResult', `‚ùå ${func}: Missing`, 'error');
                    }
                });
                
                // Test assignment form functionality
                if (window.dataManager) {
                    const hasAddMethod = typeof window.dataManager.addAssignment === 'function';
                    const hasRemoveMethod = typeof window.dataManager.removeAssignment === 'function';
                    
                    logResult('assignmentResult', `Add Assignment: ${hasAddMethod ? 'Available' : 'Missing'}`, hasAddMethod ? 'success' : 'error');
                    logResult('assignmentResult', `Remove Assignment: ${hasRemoveMethod ? 'Available' : 'Missing'}`, hasRemoveMethod ? 'success' : 'error');
                    
                    if (hasAddMethod) functionsAvailable++;
                    if (hasRemoveMethod) functionsAvailable++;
                }
                
                testResults.assignments = { functionsAvailable };
                updateTestStatus('assignmentSection', functionsAvailable >= 3 ? 'success' : 'warning');
                
            } catch (error) {
                logResult('assignmentResult', `Assignment Management Test Failed: ${error.message}`, 'error');
                updateTestStatus('assignmentSection', 'error');
                testResults.assignments = { error: error.message };
            }
        }

        // Print System Test
        async function testPrintFunctionality() {
            clearResult('printResult');
            updateTestStatus('printSection', 'testing');
            logResult('printResult', 'Testing print functionality...', 'info');
            
            try {
                // Test print-related functions
                const printFunctions = ['toggleScheduleOrientation'];
                let functionsAvailable = 0;
                
                printFunctions.forEach(func => {
                    if (typeof window[func] === 'function') {
                        logResult('printResult', `‚úÖ ${func}: Available`, 'success');
                        functionsAvailable++;
                    } else {
                        logResult('printResult', `‚ùå ${func}: Missing`, 'error');
                    }
                });
                
                // Test CSS print styles
                const styleSheets = Array.from(document.styleSheets);
                let hasPrintStyles = false;
                
                try {
                    styleSheets.forEach(sheet => {
                        if (sheet.href && sheet.href.includes('style.css')) {
                            hasPrintStyles = true;
                        }
                    });
                } catch (e) {
                    // Can't access external stylesheets due to CORS
                    hasPrintStyles = true; // Assume present
                }
                
                logResult('printResult', `Print Styles: ${hasPrintStyles ? 'Available' : 'Missing'}`, hasPrintStyles ? 'success' : 'warning');
                
                testResults.print = { functionsAvailable, totalFunctions: printFunctions.length, hasPrintStyles };
                updateTestStatus('printSection', functionsAvailable === printFunctions.length && hasPrintStyles ? 'success' : 'warning');
                
            } catch (error) {
                logResult('printResult', `Print Functionality Test Failed: ${error.message}`, 'error');
                updateTestStatus('printSection', 'error');
                testResults.print = { error: error.message };
            }
        }

        // Run All Tests
        async function runAllTests() {
            clearResult('overallResult');
            logResult('overallResult', 'Starting comprehensive functionality test...', 'info');
            
            const tests = [
                { name: 'Core System', func: testCoreSystem },
                { name: 'Authentication', func: testAuthentication },
                { name: 'Data Operations', func: testDataOperations },
                { name: 'Sync System', func: testSyncSystem },
                { name: 'UI Components', func: testUIComponents },
                { name: 'Analytics', func: testAnalytics },
                { name: 'Assignment Management', func: testAssignmentCRUD },
                { name: 'Master Data', func: testMasterData },
                { name: 'Print System', func: testPrintFunctionality }
            ];
            
            logResult('overallResult', `Running ${tests.length} test suites...`, 'info');
            
            for (const test of tests) {
                logResult('overallResult', `Testing ${test.name}...`, 'info');
                await test.func();
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests
            }
            
            // Generate summary
            setTimeout(() => {
                generateReport();
            }, 1000);
        }

        // Generate Test Report
        function generateReport() {
            clearResult('overallResult');
            logResult('overallResult', 'üìä COMPREHENSIVE TEST REPORT', 'info');
            logResult('overallResult', '=' .repeat(50), 'info');
            
            let totalPassed = 0;
            let totalFailed = 0;
            let totalTests = 0;
            
            Object.entries(testResults).forEach(([category, results]) => {
                if (results.error) {
                    logResult('overallResult', `‚ùå ${category.toUpperCase()}: ERROR - ${results.error}`, 'error');
                    totalFailed++;
                } else {
                    const passed = results.passed || results.functionsAvailable || results.availableFunctions || results.structureValid || 0;
                    const total = results.total || results.totalFunctions || results.totalMethods || results.totalStructures || 1;
                    const percentage = Math.round((passed / total) * 100);
                    
                    const status = percentage === 100 ? 'success' : (percentage >= 75 ? 'warning' : 'error');
                    logResult('overallResult', `${percentage === 100 ? '‚úÖ' : percentage >= 75 ? '‚ö†Ô∏è' : '‚ùå'} ${category.toUpperCase()}: ${passed}/${total} (${percentage}%)`, status);
                    
                    totalPassed += passed;
                    totalTests += total;
                }
            });
            
            logResult('overallResult', '=' .repeat(50), 'info');
            const overallPercentage = totalTests > 0 ? Math.round((totalPassed / totalTests) * 100) : 0;
            logResult('overallResult', `üéØ OVERALL SCORE: ${totalPassed}/${totalTests} (${overallPercentage}%)`, overallPercentage >= 90 ? 'success' : (overallPercentage >= 75 ? 'warning' : 'error'));
            
            if (overallPercentage >= 90) {
                logResult('overallResult', 'üéâ EXCELLENT! All major functionality is working correctly.', 'success');
            } else if (overallPercentage >= 75) {
                logResult('overallResult', 'üëç GOOD! Most functionality is working with minor issues.', 'warning');
            } else {
                logResult('overallResult', '‚ö†Ô∏è ATTENTION NEEDED! Several critical issues found.', 'error');
            }
            
            logResult('overallResult', `\nTest completed at ${new Date().toLocaleString()}`, 'info');
        }

        // Initialize tests when page loads
        window.addEventListener('load', function() {
            console.log('üîç LAMS Functionality Test Page Loaded');
            
            // Auto-run core tests after 2 seconds
            setTimeout(() => {
                testCoreSystem();
            }, 2000);
        });

        // Additional specific tests
        function testSignOut() {
            if (window.authManager && window.authManager.isSignedIn) {
                window.authManager.signOut();
                logResult('authResult', 'Sign out initiated', 'info');
            } else {
                logResult('authResult', 'Not signed in or auth manager not available', 'warning');
            }
        }

        function testDataValidation() {
            logResult('dataResult', 'Testing data validation...', 'info');
            if (window.dataManager && typeof window.dataManager.validateMasterDataIntegrity === 'function') {
                const result = window.dataManager.validateMasterDataIntegrity();
                logResult('dataResult', `Data validation result: ${result ? 'PASSED' : 'FAILED'}`, result ? 'success' : 'warning');
            } else {
                logResult('dataResult', 'Data validation function not available', 'warning');
            }
        }

        function testResponsiveness() {
            logResult('uiResult', 'Testing responsive design...', 'info');
            const viewportWidth = window.innerWidth;
            const isMobile = viewportWidth < 768;
            const isTablet = viewportWidth >= 768 && viewportWidth < 1024;
            const isDesktop = viewportWidth >= 1024;
            
            logResult('uiResult', `Viewport: ${viewportWidth}px (${isMobile ? 'Mobile' : isTablet ? 'Tablet' : 'Desktop'})`, 'info');
            logResult('uiResult', 'Responsive design test completed', 'success');
        }

        function testChartGeneration() {
            logResult('analyticsResult', 'Testing chart generation...', 'info');
            if (typeof Chart !== 'undefined' && window.generateSubjectAssignmentChart) {
                try {
                    // This would require actual data and canvas element
                    logResult('analyticsResult', 'Chart generation functions are available', 'success');
                } catch (error) {
                    logResult('analyticsResult', `Chart generation test failed: ${error.message}`, 'warning');
                }
            } else {
                logResult('analyticsResult', 'Chart.js or chart functions not available', 'error');
            }
        }

        function testScheduleGeneration() {
            logResult('assignmentResult', 'Testing schedule generation...', 'info');
            if (window.dataManager && window.dataManager.assignments) {
                const assignmentCount = window.dataManager.assignments.length;
                logResult('assignmentResult', `Current assignments: ${assignmentCount}`, assignmentCount > 0 ? 'success' : 'info');
                logResult('assignmentResult', 'Schedule generation capability confirmed', 'success');
            } else {
                logResult('assignmentResult', 'Schedule data not available', 'warning');
            }
        }

        function testDataIntegrity() {
            logResult('masterDataResult', 'Testing data integrity...', 'info');
            if (window.dataManager) {
                const hasValidStructure = window.dataManager.subjects && window.dataManager.faculties && window.dataManager.branches;
                logResult('masterDataResult', `Data structure integrity: ${hasValidStructure ? 'VALID' : 'INVALID'}`, hasValidStructure ? 'success' : 'error');
            } else {
                logResult('masterDataResult', 'Cannot test data integrity - DataManager not available', 'error');
            }
        }

        function testPrintPreview() {
            logResult('printResult', 'Testing print preview...', 'info');
            try {
                window.print();
                logResult('printResult', 'Print dialog opened successfully', 'success');
            } catch (error) {
                logResult('printResult', `Print preview failed: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
