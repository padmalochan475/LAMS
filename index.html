<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Institute Lab Management System</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="modal-styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
</head>
<body>
    <!-- Floating orbs for background animation -->
    <div class="floating-orbs">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
        <div class="orb orb-3"></div>
        <div class="orb orb-4"></div>
    </div>

    <!-- Main container -->
    <div class="container">
        <header class="header">
            <h1 class="header-title">Institute Lab Management System</h1>
            <div class="header-actions">
                <div id="user-info" class="user-info" style="display: none;">
                    <img id="user-avatar" class="user-avatar" src="" alt="User">
                    <span id="user-name"></span>
                    <button class="btn btn--secondary" onclick="signOut()">Sign Out</button>
                </div>
                <div id="login-section">
                    <div id="g_id_onload"
                         data-callback="handleCredentialResponse"
                         data-auto_prompt="false">
                    </div>
                    <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"></div>
                </div>
                <button class="theme-toggle btn--secondary" id="themeToggle">
                    <span class="theme-icon">üåô</span>
                </button>
            </div>
        </header>

        <!-- Navigation tabs -->
        <nav class="nav-tabs" id="main-nav" style="display: none;">
            <button class="nav-tab active" onclick="showTab('dashboard')">
                <span class="nav-icon">üìä</span>
                Dashboard
            </button>
            <button class="nav-tab" onclick="showTab('assignment')">
                <span class="nav-icon">‚ûï</span>
                Assignment
            </button>
            <button class="nav-tab" onclick="showTab('schedule')">
                <span class="nav-icon">üìÖ</span>
                Schedule
            </button>
            <button class="nav-tab" onclick="showTab('master-data')">
                <span class="nav-icon">‚öôÔ∏è</span>
                Master Data
            </button>
            <button class="nav-tab" onclick="showTab('analytics')">
                <span class="nav-icon">üìà</span>
                Analytics
            </button>
            <button class="nav-tab" onclick="showTab('print')">
                <span class="nav-icon">üñ®Ô∏è</span>
                Print Schedule
            </button>
            <button class="nav-tab" onclick="showTab('activity')">
                <span class="nav-icon">üì∞</span>
                Activity Feed
            </button>
            <button class="nav-tab admin-only" onclick="showTab('system-health')" style="display: none;">
                <span class="nav-icon">üîß</span>
                System Health
            </button>
        </nav>

        <!-- Loading Screen -->
        <div id="loadingScreen" class="loading-screen">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <p>Validating deployment...</p>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard-tab">
            <div class="dashboard-header">
                <h2>Academic Year: <span id="currentAcademicYear" class="academic-year-display" onclick="editAcademicYear()">2024-25</span></h2>
                <div class="dashboard-actions">
                    <div class="sync-status" id="syncStatus" style="display: inline-block;">
                        <span class="nav-icon">‚òÅÔ∏è</span> <span id="syncStatusText">Loading...</span>
                    </div>
                    <button class="btn btn--outline" id="enableCloudSyncBtn" style="display:none;" onclick="enableCloudSync()" title="Grant Google Drive access for background sync">
                        <span class="nav-icon">üîë</span> Enable Cloud Sync
                    </button>
                    <button class="btn btn--secondary" onclick="exportData()" title="Export Data">
                        <span class="nav-icon">üì•</span> Export
                    </button>
                    <button class="btn btn--secondary admin-btn" onclick="importData()" title="Import Data (Admin Only)">
                        <span class="nav-icon">üì§</span> Import
                    </button>
                    <button class="btn btn--secondary admin-btn" onclick="showUserManagement()" title="Manage Users (Admin Only)">
                        <span class="nav-icon">üë•</span> Users
                        <span id="pendingUsersCount" class="pending-badge" style="display: none;">0</span>
                    </button>
                </div>
            </div>
            <div class="dashboard-grid">
                <div class="stat-card glass-card">
                    <h3>Total Assignments</h3>
                    <div class="stat-number" id="totalAssignments">0</div>
                </div>
                <div class="stat-card glass-card">
                    <h3>Active Faculty</h3>
                    <div class="stat-number" id="totalFaculty">0</div>
                </div>
                <div class="stat-card glass-card">
                    <h3>Lab Rooms</h3>
                    <div class="stat-number" id="totalRooms">0</div>
                </div>
                <div class="stat-card glass-card">
                    <h3>Lab Subjects</h3>
                    <div class="stat-number" id="totalSubjects">0</div>
                </div>
            </div>
            
            <div class="recent-assignments glass-card">
                <h3>Recent Activities</h3>
                <div id="recentAssignmentsList">
                    <p class="empty-state">No assignments created yet. Add master data first, then create assignments.</p>
                </div>
            </div>
            
            <!-- Usage Statistics will be dynamically inserted here -->
            
            <!-- Admin Panel -->
            <div class="admin-panel glass-card admin-only" style="display: none;">
                <h3>Admin Panel</h3>
                <div class="admin-stats">
                    <div class="stat-item">
                        <span class="stat-label">Approved Users</span>
                        <span class="stat-value" id="approvedUsersCount">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Pending Requests</span>
                        <span class="stat-value" id="pendingRequestsCount">0</span>
                    </div>
                </div>
                <div class="admin-actions">
                    <button class="btn btn--primary" onclick="showUserManagement()">Manage Users</button>
                    <button class="btn btn--outline" onclick="clearAllData()">Clear All Data</button>
                </div>
            </div>
        </div>

        <!-- Assignment Management Tab -->
        <div class="tab-content" id="assignment-tab">
            <div class="glass-card">
                <h2>Create Lab Assignment</h2>
                <form id="assignmentForm" class="assignment-form" novalidate>
                    <div class="form-section">
                        <h3>Schedule Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Day</label>
                                <select class="form-control" id="assignmentDay" required>
                                    <option value="">Select Day</option>
                                    <option value="Monday">Monday</option>
                                    <option value="Tuesday">Tuesday</option>
                                    <option value="Wednesday">Wednesday</option>
                                    <option value="Thursday">Thursday</option>
                                    <option value="Friday">Friday</option>
                                    <option value="Saturday">Saturday</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Time Slot</label>
                                <select class="form-control" id="assignmentTimeSlot" required>
                                    <option value="">Select Time Slot</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Class Information</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <select class="form-control" id="assignmentDepartment" required>
                                    <option value="">Select Department</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Semester</label>
                                <select class="form-control" id="assignmentSemester" required>
                                    <option value="">Select Semester</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Group</label>
                                <select class="form-control" id="assignmentGroup" required>
                                    <option value="">Select Group</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Sub Group</label>
                                <select class="form-control" id="assignmentSubGroup" required>
                                    <option value="">Select Sub Group</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Lab Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Subject</label>
                                <select class="form-control" id="assignmentSubject" required>
                                    <option value="">Select Subject</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Lab Room</label>
                                <select class="form-control" id="assignmentLabRoom" required>
                                    <option value="">Select Lab Room</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>Faculty Assignment <span style="font-size: 0.8rem; color: var(--color-text-secondary);">(At least one required)</span></h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Theory Faculty <span style="color: var(--color-text-secondary); font-size: 0.8rem;">(Optional)</span></label>
                                <select class="form-control" id="assignmentTheoryFaculty">
                                    <option value="">Select Theory Faculty (Optional)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Lab Faculty <span style="color: var(--color-text-secondary); font-size: 0.8rem;">(Optional)</span></label>
                                <select class="form-control" id="assignmentLabFaculty">
                                    <option value="">Select Lab Faculty (Optional)</option>
                                </select>
                            </div>
                        </div>
                        <div class="faculty-assignment-note" style="background: var(--color-bg-1); padding: var(--space-8); border-radius: var(--radius-sm); margin-bottom: var(--space-12); border-left: 3px solid var(--color-info);">
                            <small style="color: var(--color-text-secondary);">
                                üí° <strong>Tip:</strong> Assign only the faculty needed for this class. For theory-only classes, assign only Theory Faculty. For lab-only classes, assign only Lab Faculty. For mixed classes, assign both.
                            </small>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn--primary">Create Assignment</button>
                        <button type="button" class="btn btn--secondary" id="clearForm">Clear Form</button>
                        <button type="button" class="btn btn--outline" onclick="previewAssignment()">Preview</button>
                    </div>
                </form>
            </div>
            
            <div class="glass-card">
                <h3>Existing Assignments</h3>
                <div class="search-controls">
                    <input type="text" class="form-control" id="assignmentSearch" placeholder="Search assignments...">
                    <div class="search-stats" id="searchStats"></div>
                </div>
                <div id="assignmentsList">
                    <p class="empty-state">No assignments created yet.</p>
                </div>
            </div>
        </div>

        <!-- Lab Schedule Tab -->
        <div class="tab-content" id="schedule-tab">
            <div class="glass-card">
                <h2>Interactive Lab Timetable</h2>
                <div class="schedule-controls">
                    <div class="form-group">
                        <label class="form-label">Filter by Department</label>
                        <select class="form-control" id="scheduleFilter">
                            <option value="">All Departments</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Filter by Semester</label>
                        <select class="form-control" id="scheduleSemesterFilter">
                            <option value="">All Semesters</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Filter by Group</label>
                        <select class="form-control" id="scheduleGroupFilter">
                            <option value="">All Groups</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <button class="btn btn--secondary" onclick="toggleScheduleOrientation()">
                            <span class="nav-icon">üîÑ</span> Swap View
                        </button>
                    </div>
                </div>
                <div id="scheduleGrid" class="schedule-grid">
                    <p class="empty-state">Add time slots and assignments to view the schedule.</p>
                </div>
            </div>
        </div>

        <!-- Master Data Tab -->
        <div class="tab-content" id="master-data-tab">
            <div class="master-data-grid">
                <!-- Departments -->
                <div class="glass-card">
                    <h3>Departments <span class="count-badge" id="departmentsCount">5</span></h3>
                    <div class="master-data-form">
                        <input type="text" class="form-control" id="newDepartment" placeholder="e.g., CSE">
                        <button class="btn btn--primary" onclick="addMasterDataItem('departments', 'newDepartment')">Add</button>
                    </div>
                    <div id="departmentsList" class="master-data-list"></div>
                </div>

                <!-- Semesters -->
                <div class="glass-card">
                    <h3>Semesters <span class="count-badge" id="semestersCount">8</span></h3>
                    <div class="master-data-form">
                        <input type="text" class="form-control" id="newSemester" placeholder="e.g., 1st">
                        <button class="btn btn--primary" onclick="addMasterDataItem('semesters', 'newSemester')">Add</button>
                    </div>
                    <div id="semestersList" class="master-data-list"></div>
                </div>

                <!-- Groups -->
                <div class="glass-card">
                    <h3>Groups <span class="count-badge" id="groupsCount">4</span></h3>
                    <div class="master-data-form">
                        <input type="text" class="form-control" id="newGroup" placeholder="e.g., A">
                        <button class="btn btn--primary" onclick="addMasterDataItem('groups', 'newGroup')">Add</button>
                    </div>
                    <div id="groupsList" class="master-data-list"></div>
                </div>

                <!-- Sub Groups -->
                <div class="glass-card">
                    <h3>Sub Groups <span class="count-badge" id="subGroupsCount">3</span></h3>
                    <div class="master-data-form">
                        <input type="text" class="form-control" id="newSubGroup" placeholder="e.g., 1">
                        <button class="btn btn--primary" onclick="addMasterDataItem('subGroups', 'newSubGroup')">Add</button>
                    </div>
                    <div id="subGroupsList" class="master-data-list"></div>
                </div>

                <!-- Time Slots -->
                <div class="glass-card">
                    <h3>Time Slots <span class="count-badge" id="timeSlotsCount">0</span></h3>
                    <div class="master-data-form">
                        <input type="text" class="form-control" id="newTimeSlot" placeholder="e.g., 09:00-10:00">
                        <button class="btn btn--primary" onclick="addMasterDataItem('timeSlots', 'newTimeSlot')">Add</button>
                    </div>
                    <div id="timeSlotsList" class="master-data-list"></div>
                </div>

                <!-- Subjects -->
                <div class="glass-card">
                    <h3>Subjects <span class="count-badge" id="subjectsCount">0</span></h3>
                    <div class="master-data-form">
                        <input type="text" class="form-control" id="newSubject" placeholder="e.g., OS LAB">
                        <button class="btn btn--primary" onclick="addMasterDataItem('subjects', 'newSubject')">Add</button>
                    </div>
                    <div id="subjectsList" class="master-data-list"></div>
                </div>

                <!-- Lab Rooms -->
                <div class="glass-card">
                    <h3>Lab Rooms <span class="count-badge" id="labRoomsCount">0</span></h3>
                    <div class="master-data-form">
                        <input type="text" class="form-control" id="newLabRoom" placeholder="e.g., L1">
                        <button class="btn btn--primary" onclick="addMasterDataItem('labRooms', 'newLabRoom')">Add</button>
                    </div>
                    <div id="labRoomsList" class="master-data-list"></div>
                </div>

                <!-- Theory Faculty -->
                <div class="glass-card faculty-card">
                    <h3>Theory Faculty <span class="count-badge" id="theoryFacultyCount">0</span></h3>
                    <div class="faculty-form">
                        <div class="form-group">
                            <input type="text" class="form-control" id="newTheoryFacultyShort" placeholder="Short Name (e.g., BS)">
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="newTheoryFacultyFull" placeholder="Full Name (e.g., BISWAJIT SARANGI)">
                        </div>
                        <div class="form-group">
                            <select class="form-control" id="newTheoryFacultyDept">
                                <option value="">Select Department</option>
                            </select>
                        </div>
                        <button class="btn btn--primary" onclick="addFaculty('theory')">Add Faculty</button>
                    </div>
                    <div id="theoryFacultyList" class="master-data-list"></div>
                </div>

                <!-- Lab Faculty -->
                <div class="glass-card faculty-card">
                    <h3>Lab Faculty <span class="count-badge" id="labFacultyCount">0</span></h3>
                    <div class="faculty-form">
                        <div class="form-group">
                            <input type="text" class="form-control" id="newLabFacultyShort" placeholder="Short Name (e.g., PLM)">
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="newLabFacultyFull" placeholder="Full Name (e.g., PADMALOCHAN MAHARANA)">
                        </div>
                        <div class="form-group">
                            <select class="form-control" id="newLabFacultyDept">
                                <option value="">Select Department</option>
                            </select>
                        </div>
                        <button class="btn btn--primary" onclick="addFaculty('lab')">Add Faculty</button>
                    </div>
                    <div id="labFacultyList" class="master-data-list"></div>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div class="tab-content" id="analytics-tab">
            <div class="analytics-grid">
                <div class="glass-card">
                    <h3>Faculty Workload Distribution</h3>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="facultyWorkloadChart"></canvas>
                    </div>
                </div>
                <div class="glass-card">
                    <h3>Subject Popularity</h3>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="subjectDistributionChart"></canvas>
                    </div>
                </div>
                <div class="glass-card">
                    <h3>Room Utilization Analysis</h3>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="roomUtilizationChart"></canvas>
                    </div>
                </div>
                <div class="glass-card">
                    <h3>Department Comparison</h3>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="departmentOverviewChart"></canvas>
                    </div>
                </div>
                <div class="glass-card">
                    <h3>Time Slot Efficiency</h3>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="timeSlotChart"></canvas>
                    </div>
                </div>
                <div class="glass-card">
                    <h3>Weekly Schedule Heatmap</h3>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="heatmapChart"></canvas>
                    </div>
                </div>
                
                <!-- New Interactive Analytics -->
                <div class="glass-card">
                    <h3>üìö Subject-Faculty Assignment Analysis</h3>
                    <div class="analytics-filters">
                        <select id="subjectFilter" class="form-control" onchange="updateSubjectFacultyAnalysis()">
                            <option value="">All Subjects</option>
                        </select>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="subjectFacultyChart"></canvas>
                    </div>
                    <div class="analytics-stats">
                        <div class="stat-item">
                            <span class="stat-label">Average Faculty per Subject:</span>
                            <span id="avgFacultyPerSubject" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Most Popular Subject:</span>
                            <span id="mostPopularSubject" class="stat-value">-</span>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card">
                    <h3>üìä Weekly Workload Distribution</h3>
                    <div class="analytics-filters">
                        <label>
                            <input type="checkbox" id="showTheoryOnly" onchange="updateWeeklyWorkload()"> Theory Only
                        </label>
                        <label>
                            <input type="checkbox" id="showLabOnly" onchange="updateWeeklyWorkload()"> Lab Only
                        </label>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="weeklyWorkloadChart"></canvas>
                    </div>
                    <div class="analytics-stats">
                        <div class="stat-item">
                            <span class="stat-label">Peak Day:</span>
                            <span id="peakDay" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Total Weekly Hours:</span>
                            <span id="totalWeeklyHours" class="stat-value">0</span>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card">
                    <h3>üè¢ Department Resource Utilization</h3>
                    <div class="analytics-filters">
                        <select id="departmentFilter" class="form-control" onchange="updateDepartmentAnalysis()">
                            <option value="">All Departments</option>
                        </select>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="departmentResourceChart"></canvas>
                    </div>
                    <div class="analytics-stats">
                        <div class="stat-item">
                            <span class="stat-label">Lab Utilization:</span>
                            <span id="labUtilization" class="stat-value">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Faculty Efficiency:</span>
                            <span id="facultyEfficiency" class="stat-value">0%</span>
                        </div>
                    </div>
                </div>
                
                <!-- New Advanced Analytics -->
                
                <!-- Time Slot Efficiency Analysis -->
                <div class="glass-card">
                    <h3>‚è∞ Time Slot Efficiency Analysis</h3>
                    <div class="analytics-filters">
                        <select id="timeSlotFilter" class="form-control" onchange="updateTimeSlotAnalysis()">
                            <option value="">All Time Slots</option>
                            <option value="morning">Morning (9-12)</option>
                            <option value="afternoon">Afternoon (12-16)</option>
                            <option value="evening">Evening (16-18)</option>
                        </select>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="timeSlotChart"></canvas>
                    </div>
                    <div class="analytics-stats">
                        <div class="stat-item">
                            <span class="stat-label">Most Utilized Time:</span>
                            <span id="peakTimeSlot" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Efficiency Rate:</span>
                            <span id="timeEfficiency" class="stat-value">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Free Slots:</span>
                            <span id="availableSlots" class="stat-value">0</span>
                        </div>
                    </div>
                </div>

                <!-- Lab vs Theory Distribution -->
                <div class="glass-card">
                    <h3>üî¨ Lab vs Theory Distribution</h3>
                    <div class="analytics-filters">
                        <label>
                            <input type="checkbox" id="showByDepartment" onchange="updateLabTheoryAnalysis()"> Group by Department
                        </label>
                        <label>
                            <input type="checkbox" id="showPercentage" onchange="updateLabTheoryAnalysis()"> Show Percentages
                        </label>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="labTheoryChart"></canvas>
                    </div>
                    <div class="analytics-stats">
                        <div class="stat-item">
                            <span class="stat-label">Lab Classes:</span>
                            <span id="totalLabClasses" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Theory Classes:</span>
                            <span id="totalTheoryClasses" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Lab/Theory Ratio:</span>
                            <span id="labTheoryRatio" class="stat-value">0:0</span>
                        </div>
                    </div>
                </div>

                <!-- Faculty Performance Metrics -->
                <div class="glass-card">
                    <h3>üìà Faculty Performance Metrics</h3>
                    <div class="analytics-filters">
                        <select id="performanceMetric" class="form-control" onchange="updateFacultyPerformance()">
                            <option value="workload">Workload Distribution</option>
                            <option value="diversity">Subject Diversity</option>
                            <option value="efficiency">Teaching Efficiency</option>
                        </select>
                        <input type="range" id="performanceThreshold" min="0" max="100" value="75" oninput="updateFacultyPerformance()" style="flex: 1;">
                        <span id="thresholdDisplay" class="threshold-display">75%</span>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="facultyPerformanceChart"></canvas>
                    </div>
                    <div class="analytics-stats">
                        <div class="stat-item">
                            <span class="stat-label">Top Performer:</span>
                            <span id="topPerformer" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Average Score:</span>
                            <span id="avgPerformanceScore" class="stat-value">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Above Threshold:</span>
                            <span id="aboveThreshold" class="stat-value">0</span>
                        </div>
                    </div>
                </div>

                <!-- Room Utilization Heatmap -->
                <div class="glass-card">
                    <h3>üè´ Room Utilization Heatmap</h3>
                    <div class="analytics-filters">
                        <select id="roomTypeFilter" class="form-control" onchange="updateRoomUtilization()">
                            <option value="">All Rooms</option>
                            <option value="lab">Lab Rooms Only</option>
                            <option value="theory">Theory Rooms Only</option>
                        </select>
                        <select id="dayFilter" class="form-control" onchange="updateRoomUtilization()">
                            <option value="">All Days</option>
                            <option value="monday">Monday</option>
                            <option value="tuesday">Tuesday</option>
                            <option value="wednesday">Wednesday</option>
                            <option value="thursday">Thursday</option>
                            <option value="friday">Friday</option>
                            <option value="saturday">Saturday</option>
                        </select>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="roomUtilizationChart"></canvas>
                    </div>
                    <div class="analytics-stats">
                        <div class="stat-item">
                            <span class="stat-label">Most Used Room:</span>
                            <span id="mostUsedRoom" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Average Utilization:</span>
                            <span id="avgRoomUtilization" class="stat-value">0%</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Underutilized Rooms:</span>
                            <span id="underutilizedRooms" class="stat-value">0</span>
                        </div>
                    </div>
                </div>

                <!-- Assignment Complexity Analysis -->
                <div class="glass-card">
                    <h3>üéØ Assignment Complexity Analysis</h3>
                    <div class="analytics-filters">
                        <select id="complexityView" class="form-control" onchange="updateComplexityAnalysis()">
                            <option value="faculty">By Faculty Count</option>
                            <option value="timing">By Time Conflicts</option>
                            <option value="resources">By Resource Requirements</option>
                        </select>
                        <label>
                            <input type="checkbox" id="showComplexityTrends" onchange="updateComplexityAnalysis()"> Show Trends
                        </label>
                    </div>
                    <div class="chart-container" style="position: relative; height: 300px;">
                        <canvas id="complexityChart"></canvas>
                    </div>
                    <div class="analytics-stats">
                        <div class="stat-item">
                            <span class="stat-label">Most Complex Assignment:</span>
                            <span id="mostComplexAssignment" class="stat-value">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Avg Complexity Score:</span>
                            <span id="avgComplexity" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">High Complexity Count:</span>
                            <span id="highComplexityCount" class="stat-value">0</span>
                        </div>
                    </div>
                </div>

                <!-- Resource Optimization Dashboard -->
                <div class="glass-card" style="grid-column: 1 / -1;">
                    <h3>üéõÔ∏è Resource Optimization Dashboard</h3>
                    <div class="analytics-filters">
                        <select id="optimizationView" class="form-control" onchange="updateOptimizationDashboard()">
                            <option value="overview">Overview</option>
                            <option value="conflicts">Conflict Analysis</option>
                            <option value="suggestions">Optimization Suggestions</option>
                        </select>
                        <button class="btn btn--primary" onclick="generateOptimizationReport()">
                            üìä Generate Report
                        </button>
                    </div>
                    <div class="optimization-dashboard">
                        <div class="optimization-grid">
                            <div class="optimization-card">
                                <h4>‚ö° Quick Stats</h4>
                                <div id="quickStats" class="quick-stats">
                                    <div class="quick-stat">
                                        <span class="quick-stat-value" id="totalAssignments">0</span>
                                        <span class="quick-stat-label">Total Assignments</span>
                                    </div>
                                    <div class="quick-stat">
                                        <span class="quick-stat-value" id="resourceConflicts">0</span>
                                        <span class="quick-stat-label">Conflicts</span>
                                    </div>
                                    <div class="quick-stat">
                                        <span class="quick-stat-value" id="optimizationScore">0%</span>
                                        <span class="quick-stat-label">Optimization</span>
                                    </div>
                                </div>
                            </div>
                            <div class="optimization-card">
                                <h4>üîß Suggestions</h4>
                                <div id="optimizationSuggestions" class="suggestions-list">
                                    <p class="empty-state">Analyzing schedule for optimization opportunities...</p>
                                </div>
                            </div>
                        </div>
                        <div class="chart-container" style="position: relative; height: 250px; margin-top: 20px;">
                            <canvas id="optimizationChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Faculty Workload Table -->
                <div class="glass-card" style="grid-column: 1 / -1;">
                    <h3>üë®‚Äçüè´ Faculty Workload Analysis</h3>
                    <div class="analytics-filters">
                        <select id="facultyTypeFilter" class="form-control" onchange="updateFacultyWorkloadTable()">
                            <option value="all">All Faculty</option>
                            <option value="theory">Theory Faculty</option>
                            <option value="lab">Lab Faculty</option>
                            <option value="mixed">Mixed Assignment Faculty</option>
                        </select>
                        <input type="text" id="facultySearchFilter" class="form-control" placeholder="Search faculty..." oninput="updateFacultyWorkloadTable()" style="flex: 1; min-width: 200px;">
                    </div>
                    <div id="facultyWorkloadTable" class="faculty-workload-table" style="overflow-x: auto; margin-top: 15px;">
                        <p class="empty-state">Loading faculty workload data...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Print Tab - Advanced Professional Print System -->
        <div class="tab-content" id="print-tab">
            <!-- Print Configuration Panel -->
            <div class="print-config-panel no-print">
                <div class="config-header">
                    <h2>üñ®Ô∏è Advanced Print & Export System</h2>
                    <p class="config-subtitle">Professional lab schedule printing with customizable layouts and formats</p>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="btn btn--primary btn-large" onclick="quickPrint()">
                        <span class="btn-icon">üñ®Ô∏è</span> Quick Print
                    </button>
                    <button class="btn btn--secondary btn-large" onclick="showPrintPreview()">
                        <span class="btn-icon">üëÅÔ∏è</span> Preview
                    </button>
                    <button class="btn btn--outline btn-large" onclick="exportToPDF()">
                        <span class="btn-icon">üìÑ</span> Export PDF
                    </button>
                    <button class="btn btn--outline btn-large" onclick="exportToExcel()">
                        <span class="btn-icon">üìä</span> Export Excel
                    </button>
                </div>

                <!-- Configuration Tabs -->
                <div class="config-tabs">
                    <button class="config-tab active" onclick="switchConfigTab('filters')">
                        <span class="tab-icon">üîç</span> Filters
                    </button>
                    <button class="config-tab" onclick="switchConfigTab('layout')">
                        <span class="tab-icon">üìã</span> Layout
                    </button>
                    <button class="config-tab" onclick="switchConfigTab('styling')">
                        <span class="tab-icon">üé®</span> Styling
                    </button>
                    <button class="config-tab" onclick="switchConfigTab('export')">
                        <span class="tab-icon">‚öôÔ∏è</span> Advanced
                    </button>
                </div>

                <!-- Filters Tab -->
                <div class="config-tab-content active" id="filters-tab">
                    <div class="filter-section">
                        <h3>üìä Data Filters</h3>
                        <div class="filter-grid">
                            <div class="filter-group">
                                <label class="form-label">Department</label>
                                <select class="form-control" id="printDepartmentFilter" onchange="updatePrintPreview()">
                                    <option value="">All Departments</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">Semester</label>
                                <select class="form-control" id="printSemesterFilter" onchange="updatePrintPreview()">
                                    <option value="">All Semesters</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">Group</label>
                                <select class="form-control" id="printGroupFilter" onchange="updatePrintPreview()">
                                    <option value="">All Groups</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">Subject</label>
                                <select class="form-control" id="printSubjectFilter" onchange="updatePrintPreview()">
                                    <option value="">All Subjects</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">Faculty</label>
                                <select class="form-control" id="printFacultyFilter" onchange="updatePrintPreview()">
                                    <option value="">All Faculty</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">Room</label>
                                <select class="form-control" id="printRoomFilter" onchange="updatePrintPreview()">
                                    <option value="">All Rooms</option>
                                </select>
                            </div>
                        </div>
                        
                        <h3>üìÖ Date & Time Filters</h3>
                        <div class="filter-grid">
                            <div class="filter-group">
                                <label class="form-label">Days</label>
                                <div class="checkbox-group">
                                    <label><input type="checkbox" id="filterMonday" checked onchange="updatePrintPreview()"> Monday</label>
                                    <label><input type="checkbox" id="filterTuesday" checked onchange="updatePrintPreview()"> Tuesday</label>
                                    <label><input type="checkbox" id="filterWednesday" checked onchange="updatePrintPreview()"> Wednesday</label>
                                    <label><input type="checkbox" id="filterThursday" checked onchange="updatePrintPreview()"> Thursday</label>
                                    <label><input type="checkbox" id="filterFriday" checked onchange="updatePrintPreview()"> Friday</label>
                                    <label><input type="checkbox" id="filterSaturday" checked onchange="updatePrintPreview()"> Saturday</label>
                                </div>
                            </div>
                            <div class="filter-group">
                                <label class="form-label">Time Range</label>
                                <div class="time-range">
                                    <input type="time" class="form-control" id="printTimeStart" value="09:00" onchange="updatePrintPreview()">
                                    <span>to</span>
                                    <input type="time" class="form-control" id="printTimeEnd" value="18:00" onchange="updatePrintPreview()">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Layout Tab -->
                <div class="config-tab-content" id="layout-tab">
                    <div class="layout-section">
                        <h3>üìã Layout Options</h3>
                        <div class="layout-selector">
                            <div class="layout-option active" data-layout="grid" onclick="selectLayout('grid')">
                                <div class="layout-preview">
                                    <div class="preview-grid"></div>
                                </div>
                                <span class="layout-name">Grid View</span>
                                <p class="layout-desc">Traditional time-slot grid layout</p>
                            </div>
                            <div class="layout-option" data-layout="timeline" onclick="selectLayout('timeline')">
                                <div class="layout-preview">
                                    <div class="preview-timeline"></div>
                                </div>
                                <span class="layout-name">Timeline View</span>
                                <p class="layout-desc">Horizontal timeline format</p>
                            </div>
                            <div class="layout-option" data-layout="list" onclick="selectLayout('list')">
                                <div class="layout-preview">
                                    <div class="preview-list"></div>
                                </div>
                                <span class="layout-name">List View</span>
                                <p class="layout-desc">Detailed list format</p>
                            </div>
                            <div class="layout-option" data-layout="compact" onclick="selectLayout('compact')">
                                <div class="layout-preview">
                                    <div class="preview-compact"></div>
                                </div>
                                <span class="layout-name">Compact View</span>
                                <p class="layout-desc">Space-efficient format</p>
                            </div>
                        </div>

                        <h3>üìÑ Page Settings</h3>
                        <div class="page-settings">
                            <div class="setting-group">
                                <label class="form-label">Paper Size</label>
                                <select class="form-control" id="paperSize" onchange="updatePrintPreview()">
                                    <option value="A4">A4 (210 √ó 297 mm)</option>
                                    <option value="A3">A3 (297 √ó 420 mm)</option>
                                    <option value="Letter">Letter (8.5 √ó 11 in)</option>
                                    <option value="Legal">Legal (8.5 √ó 14 in)</option>
                                    <option value="Tabloid">Tabloid (11 √ó 17 in)</option>
                                </select>
                            </div>
                            <div class="setting-group">
                                <label class="form-label">Orientation</label>
                                <div class="radio-group">
                                    <label><input type="radio" name="orientation" value="portrait" onchange="updatePrintPreview()"> Portrait</label>
                                    <label><input type="radio" name="orientation" value="landscape" checked onchange="updatePrintPreview()"> Landscape</label>
                                </div>
                            </div>
                            <div class="setting-group">
                                <label class="form-label">Margins</label>
                                <select class="form-control" id="marginSize" onchange="updatePrintPreview()">
                                    <option value="minimal">Minimal (5mm)</option>
                                    <option value="normal" selected>Normal (20mm)</option>
                                    <option value="wide">Wide (30mm)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Styling Tab -->
                <div class="config-tab-content" id="styling-tab">
                    <div class="styling-section">
                        <h3>üé® Visual Styling</h3>
                        <div class="styling-options">
                            <div class="style-group">
                                <label class="form-label">Color Scheme</label>
                                <div class="color-scheme-selector">
                                    <div class="color-scheme active" data-scheme="professional" onclick="selectColorScheme('professional')">
                                        <div class="scheme-preview professional-preview"></div>
                                        <span>Professional</span>
                                    </div>
                                    <div class="color-scheme" data-scheme="vibrant" onclick="selectColorScheme('vibrant')">
                                        <div class="scheme-preview vibrant-preview"></div>
                                        <span>Vibrant</span>
                                    </div>
                                    <div class="color-scheme" data-scheme="minimal" onclick="selectColorScheme('minimal')">
                                        <div class="scheme-preview minimal-preview"></div>
                                        <span>Minimal</span>
                                    </div>
                                    <div class="color-scheme" data-scheme="high-contrast" onclick="selectColorScheme('high-contrast')">
                                        <div class="scheme-preview contrast-preview"></div>
                                        <span>High Contrast</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="style-group">
                                <label class="form-label">Font Settings</label>
                                <div class="font-settings">
                                    <select class="form-control" id="fontFamily" onchange="updatePrintPreview()">
                                        <option value="system">System Default</option>
                                        <option value="arial">Arial</option>
                                        <option value="helvetica">Helvetica</option>
                                        <option value="times">Times New Roman</option>
                                        <option value="georgia">Georgia</option>
                                        <option value="calibri">Calibri</option>
                                    </select>
                                    <div class="font-size-controls">
                                        <label>Font Size:</label>
                                        <input type="range" id="fontSize" min="8" max="16" value="12" onchange="updatePrintPreview()">
                                        <span id="fontSizeValue">12px</span>
                                    </div>
                                </div>
                            </div>

                            <div class="style-group">
                                <label class="form-label">Display Options</label>
                                <div class="display-checkboxes">
                                    <label><input type="checkbox" id="showHeader" checked onchange="updatePrintPreview()"> Show Header</label>
                                    <label><input type="checkbox" id="showFooter" checked onchange="updatePrintPreview()"> Show Footer</label>
                                    <label><input type="checkbox" id="showLegend" checked onchange="updatePrintPreview()"> Show Legend</label>
                                    <label><input type="checkbox" id="showPageNumbers" checked onchange="updatePrintPreview()"> Page Numbers</label>
                                    <label><input type="checkbox" id="showTimestamp" checked onchange="updatePrintPreview()"> Timestamp</label>
                                    <label><input type="checkbox" id="showWatermark" onchange="updatePrintPreview()"> Watermark</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Tab -->
                <div class="config-tab-content" id="export-tab">
                    <div class="advanced-section">
                        <h3>‚öôÔ∏è Advanced Options</h3>
                        <div class="advanced-options">
                            <div class="option-group">
                                <label class="form-label">Custom Title</label>
                                <input type="text" class="form-control" id="customTitle" placeholder="Enter custom title..." onchange="updatePrintPreview()">
                            </div>
                            <div class="option-group">
                                <label class="form-label">Institution Name</label>
                                <input type="text" class="form-control" id="institutionName" value="Trident Academy of Technology" onchange="updatePrintPreview()">
                            </div>
                            <div class="option-group">
                                <label class="form-label">Academic Year</label>
                                <input type="text" class="form-control" id="academicYear" value="2024-25" onchange="updatePrintPreview()">
                            </div>
                            <div class="option-group">
                                <label class="form-label">Custom Footer</label>
                                <textarea class="form-control" id="customFooter" rows="2" placeholder="Enter custom footer text..." onchange="updatePrintPreview()"></textarea>
                            </div>
                        </div>

                        <h3>üì§ Export Settings</h3>
                        <div class="export-settings">
                            <div class="export-format">
                                <label class="form-label">Export Format</label>
                                <div class="format-buttons">
                                    <button class="format-btn active" data-format="pdf" onclick="selectExportFormat('pdf')">
                                        <span class="format-icon">üìÑ</span> PDF
                                    </button>
                                    <button class="format-btn" data-format="excel" onclick="selectExportFormat('excel')">
                                        <span class="format-icon">üìä</span> Excel
                                    </button>
                                    <button class="format-btn" data-format="csv" onclick="selectExportFormat('csv')">
                                        <span class="format-icon">üìù</span> CSV
                                    </button>
                                    <button class="format-btn" data-format="image" onclick="selectExportFormat('image')">
                                        <span class="format-icon">üñºÔ∏è</span> Image
                                    </button>
                                </div>
                            </div>
                            <div class="quality-settings">
                                <label class="form-label">Quality Settings</label>
                                <select class="form-control" id="exportQuality">
                                    <option value="draft">Draft (Fast)</option>
                                    <option value="normal" selected>Normal</option>
                                    <option value="high">High Quality</option>
                                    <option value="print">Print Ready</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Print Preview Area -->
            <div class="print-preview-container">
                <div class="preview-header no-print">
                    <h3>üìÑ Live Preview</h3>
                    <div class="preview-controls">
                        <button class="btn btn--sm" onclick="zoomPreview(-0.1)">üîç-</button>
                        <span id="zoomLevel">100%</span>
                        <button class="btn btn--sm" onclick="zoomPreview(0.1)">üîç+</button>
                        <button class="btn btn--sm" onclick="resetZoom()">Reset</button>
                    </div>
                </div>
                
                <div id="printSchedule" class="print-schedule">
                    <!-- Dynamic content will be inserted here -->
                    <div class="loading-preview">
                        <div class="loading-spinner"></div>
                        <p>Generating preview...</p>
                    </div>
                </div>
            </div>
        </div>
                </div>
            </div>
        </div>

        <!-- Activity Feed Tab -->
        <div class="tab-content" id="activity-tab">
            <div class="glass-card">
                <h2>Real-Time Activity Feed</h2>
                <div class="activity-controls">
                    <button class="btn btn--secondary" onclick="refreshActivityFeed()">
                        <span class="nav-icon">üîÑ</span> Refresh
                    </button>
                    <button class="btn btn--outline" onclick="clearActivityFeed()">
                        <span class="nav-icon">üóëÔ∏è</span> Clear All
                    </button>
                    <div class="activity-stats">
                        <span id="activityCount">0 activities</span>
                    </div>
                </div>
                <div id="activityFeed" class="activity-feed">
                    <p class="empty-state">No recent activities.</p>
                </div>
            </div>
        </div>

        <!-- System Health Tab (Admin Only) -->
        <div class="tab-content admin-only" id="system-health-tab" style="display: none;">
            <div class="glass-card">
                <h2>üîß System Health Monitor</h2>
                <p class="tab-description">Comprehensive system diagnostics and health monitoring for LAMS</p>
                
                <div class="health-controls">
                    <button class="btn btn--primary" onclick="runSystemHealthCheck()">
                        <span class="nav-icon">üîç</span> Run Full Health Check
                    </button>
                    <button class="btn btn--secondary" onclick="runQuickDiagnostic()">
                        <span class="nav-icon">‚ö°</span> Quick Diagnostic
                    </button>
                    <button class="btn btn--outline" onclick="exportSystemReport()">
                        <span class="nav-icon">üìã</span> Export Report
                    </button>
                    <label class="toggle-control" style="margin-left: auto; display: inline-flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="toggleSafeMode" onchange="toggleSafeModeRuntime()">
                        <span>Analytics Safe Mode</span>
                    </label>
                </div>

                <div class="health-dashboard">
                    <div class="health-section">
                        <h3>üîß Core Components</h3>
                        <div id="core-components-status" class="health-status-grid">
                            <div class="status-item" id="status-datamanager">
                                <span class="status-icon">‚è≥</span>
                                <span class="status-label">DataManager</span>
                                <span class="status-value">Checking...</span>
                            </div>
                            <div class="status-item" id="status-authmanager">
                                <span class="status-icon">‚è≥</span>
                                <span class="status-label">AuthManager</span>
                                <span class="status-value">Checking...</span>
                            </div>
                            <div class="status-item" id="status-config">
                                <span class="status-icon">‚è≥</span>
                                <span class="status-label">Configuration</span>
                                <span class="status-value">Checking...</span>
                            </div>
                            <div class="status-item" id="status-sync">
                                <span class="status-icon">‚è≥</span>
                                <span class="status-label">Cloud Sync</span>
                                <span class="status-value">Checking...</span>
                            </div>
                        </div>
                    </div>

                    <div class="health-section">
                        <h3>üìä Data Integrity</h3>
                        <div id="data-integrity-status" class="health-metrics">
                            <div class="metric-item">
                                <span class="metric-label">Total Assignments:</span>
                                <span id="metric-assignments" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Master Data Items:</span>
                                <span id="metric-masterdata" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Faculty Members:</span>
                                <span id="metric-faculty" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Last Sync:</span>
                                <span id="metric-lastsync" class="metric-value">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="health-section">
                        <h3>üåê System Performance</h3>
                        <div id="performance-status" class="health-metrics">
                            <div class="metric-item">
                                <span class="metric-label">App Load Time:</span>
                                <span id="metric-loadtime" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Memory Usage:</span>
                                <span id="metric-memory" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Sync Success Rate:</span>
                                <span id="metric-syncrate" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Error Count:</span>
                                <span id="metric-errors" class="metric-value">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="health-section">
                        <h3>üîç Diagnostic Results</h3>
                        <div id="diagnostic-results" class="diagnostic-output">
                            <p class="empty-state">Run a health check to see diagnostic results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.5.0/dist/chart.min.js"></script>
    
    <!-- Application Scripts -->
    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script src="app.js"></script>
</body>
</html>